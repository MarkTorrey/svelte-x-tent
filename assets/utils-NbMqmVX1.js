import{bj as f,aJ as u,gb as j,O as z,bx as p,gv as m,gw as v,gx as S,aI as _,gy as E,_ as C,gz as O}from"./index-eSY5-lt-.js";import{C as d}from"./cimSymbolUtils-i5s4LTBQ.js";import{e as R}from"./LRUCache-mFQSPLKh.js";const w="picture-fill",g="simple-fill",I="simple-line",k="simple-marker",D="text",J="cim",b=new R(1e3);function Z(t){const n=t.style;let e=null;if(t)switch(t.type){case k:n!=="cross"&&n!=="x"&&(e=t.color);break;case g:n==="solid"?e=t.color:n!=="none"&&(e={type:"pattern",x:0,y:0,src:j(`esri/symbols/patterns/${n}.png`),width:5,height:5});break;case w:e={type:"pattern",src:t.url,width:u(t.width)*t.xscale,height:u(t.height)*t.yscale,x:u(t.xoffset),y:u(t.yoffset)};break;case D:e=t.color;break;case J:e=d(t)}return e}function tt(t,n){const e=t+"-"+n;return b.get(e)!==void 0?Promise.resolve(b.get(e)):z(t,{responseType:"image"}).then(o=>{const r=o.data,l=r.naturalWidth,s=r.naturalHeight,a=document.createElement("canvas");a.width=l,a.height=s;const i=a.getContext("2d");i.fillStyle=n,i.fillRect(0,0,l,s),i.globalCompositeOperation="destination-in",i.drawImage(r,0,0);const c=a.toDataURL();return b.put(e,c),c})}function $(t){if(!t)return null;let n=null;switch(t.type){case g:case w:case k:n=$(t.outline);break;case I:{const e=u(t.width);t.style!=null&&t.style!=="none"&&e!==0&&(n={color:t.color,style:P(t.style),width:e,cap:t.cap,join:t.join==="miter"?u(t.miterLimit):t.join});break}default:n=null}return n}const P=(()=>{const t={};return n=>{if(t[n])return t[n];const e=n.replaceAll("-","");return t[n]=e,e}})(),nt=new f([128,128,128]),A=new f("white");function M(t){var e,o;const n=(e=t.symbolLayers)==null?void 0:e.at(-1);if(n&&"outline"in n)return(o=n==null?void 0:n.outline)==null?void 0:o.size}function et(t){var n;if(!t)return 0;if(p(t)){const e=M(t);return e??0}return _((n=$(t))==null?void 0:n.width)}function ot(t){if(t==null||!("symbolLayers"in t)||t.symbolLayers==null)return!1;switch(t.type){case"point-3d":return t.symbolLayers.some(n=>n.type==="object");case"line-3d":return t.symbolLayers.some(n=>n.type==="path");case"polygon-3d":return t.symbolLayers.some(n=>n.type==="object"||n.type==="extrude");default:return!1}}function rt(t){var n;return((n=t.resource)==null?void 0:n.href)??""}function lt(t,n){if(!t)return null;let e=null;return p(t)?e=N(t):m(t)&&(e=t.type==="cim"?d(t):t.color?new f(t.color):null),e?h(e,n):null}function N(t){const n=t.symbolLayers;if(!n)return null;let e=null;return n.forEach(o=>{var r;o.type==="object"&&((r=o.resource)!=null&&r.href)||(e=o.type==="water"?o.color:o.material?o.material.color:null)}),e?new f(e):null}function h(t,n){if(n==null||t==null)return t;const e=t.toRgba();return e[3]=e[3]*n,new f(e)}function T(t,n,e){const o=t.symbolLayers;if(!o)return;const r=l=>h(n=n??l??(e!=null?A:null),e);o.forEach(l=>{var s,a;if(l.type!=="object"||!((s=l.resource)!=null&&s.href)||n)if(l.type==="water")l.color=r(l.color);else{const i=l.material!=null?l.material.color:null,c=r(i);l.material==null?l.material=new O({color:c}):l.material.color=c,e!=null&&"outline"in l&&((a=l.outline)==null?void 0:a.color)!=null&&(l.outline.color=h(l.outline.color,e))}})}function U(t,n,e){var o;(n=n??t.color)&&(t.color=h(n,e)),e!=null&&"outline"in t&&((o=t.outline)!=null&&o.color)&&(t.outline.color=h(t.outline.color,e))}function it(t,n,e){t&&(n||e!=null)&&(n&&(n=new f(n)),p(t)?T(t,n,e):m(t)&&U(t,n,e))}async function H(t,n){const e=t.symbolLayers;e&&await v(e,async o=>V(o,n))}async function V(t,n){switch(t.type){case"extrude":q(t,n);break;case"icon":case"line":case"text":W(t,n);break;case"path":F(t,n);break;case"object":await B(t,n)}}function W(t,n){const e=x(n);e!=null&&(t.size=e)}function x(t){for(const n of t)if(typeof n=="number")return n;return null}function q(t,n){t.size=typeof n[2]=="number"?n[2]:0}async function B(t,n){const{resourceSize:e,symbolSize:o}=await G(t),r=L(n,e,o);t.width=y(n[0],o[0],e[0],r),t.depth=y(n[1],o[1],e[1],r),t.height=y(n[2],o[2],e[2],r)}function F(t,n){const e=L(n,E,[t.width,void 0,t.height]);t.width=y(n[0],t.width,1,e),t.height=y(n[2],t.height,1,e)}function L(t,n,e){for(let o=0;o<3;o++){const r=t[o];switch(r){case"symbol-value":{const l=e[o];return l!=null?l/n[o]:1}case"proportional":break;default:if(r&&n[o])return r/n[o]}}return 1}async function G(t){const{computeObjectLayerResourceSize:n}=await C(()=>import("./symbolLayerUtils-jMKqIz59.js"),__vite__mapDeps([0,1,2,3]),import.meta.url),e=await n(t,10),{width:o,height:r,depth:l}=t,s=[o,l,r];let a=1;for(let i=0;i<3;i++){const c=s[i];if(c!=null){a=c/e[i];break}}for(let i=0;i<3;i++)s[i]==null&&(s[i]=e[i]*a);return{resourceSize:e,symbolSize:s}}function y(t,n,e,o){switch(t){case"proportional":return e*o;case"symbol-value":return n??e;default:return t}}function K(t,n){const e=x(n);if(e!=null)switch(t.type){case"simple-marker":t.size=e;break;case"picture-marker":{const o=t.width/t.height;o>1?(t.width=e,t.height=e*o):(t.width=e*o,t.height=e);break}case"simple-line":t.width=e;break;case"text":t.font.size=e}}async function st(t,n){if(t&&n)return p(t)?H(t,n):void(m(t)&&K(t,n))}function at(t,n,e){if(t&&n!=null)if(p(t)){const o=t.symbolLayers;o&&o.forEach(r=>{if(r&&r.type==="object")switch(e){case"tilt":r.tilt=n;break;case"roll":r.roll=n;break;default:r.heading=n}})}else m(t)&&(t.type!=="simple-marker"&&t.type!=="picture-marker"&&t.type!=="text"||(t.angle=n))}function ct(t){if(!t)return null;const n=t.effects.filter(e=>e.type!=="bloom").map(e=>e.toJSON());return S(n)}function ut(t){return t!=null&&t.type==="polygon-3d"&&t.symbolLayers.some(n=>n.type==="extrude")}async function ft(t,n){return await t.fetchSymbol(n)||t.fetchCIMSymbol(n)}export{at as D,ct as I,ut as J,ft as N,st as R,lt as a,ot as b,P as d,Z as f,nt as g,tt as h,it as k,et as m,rt as p,$ as y};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./symbolLayerUtils-jMKqIz59.js","./index-eSY5-lt-.js","./index-5m03CWEM.css","./LRUCache-mFQSPLKh.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}