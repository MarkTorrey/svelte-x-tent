import{gK as H,_ as E,c4 as L,l as $,n as x,aa as T,ah as p}from"./index-eSY5-lt-.js";const k=H(),P=new Map,j=new Map;async function B(t,n,a=!1){var s,d;if(!t||!n)return!0;const r=t.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),i=(s=j.get(r))==null?void 0:s.entries();if(i){for(const[l,c]of i)if(c.name===n){const u=!((d=c.stack)!=null&&d.hasForwardEdits());if(!u&&a){const[{deleteForwardEdits:m},{default:h}]=await Promise.all([E(()=>import("./deleteForwardEdits-Csh5R32j.js"),__vite__mapDeps([0,1,2]),import.meta.url),E(()=>import("./DeleteForwardEditsParameters-77VhraqZ.js"),__vite__mapDeps([3,1,2]),import.meta.url)]);return m(r,l,new h({sessionId:k,moment:c.moment}))}return u}}return!0}function U(t,n){var i;if(!t)return!1;const a=t.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),r=(i=j.get(a))==null?void 0:i.entries();if(r){for(const[s,d]of r)if(d.name===n)return d.lockType==="edit"}return!1}const g=new L.EventEmitter;function D(t){return g.on("apply-edits",new WeakRef(t))}function O(t){return g.on("update-moment",new WeakRef(t))}function C(t,n,a=null,r=!1){const i=T();return r=n==null||r,g.emit("apply-edits",{serviceUrl:t,layerId:n,gdbVersion:a,mayReceiveServiceEdits:r,result:i.promise}),i}const w="esri.layers.mixins.EditBusLayer",A=Symbol(w);function K(t){return t!=null&&typeof t=="object"&&A in t}function b(t){return t!=null&&typeof t=="object"&&"gdbVersion"in t}function f(t,n,a){const r=new URL(t).host,i=P.get(r),s=d=>!d||d===i;return s(n)&&s(a)||n===a}const q=t=>{var n;let a=class extends t{constructor(...r){super(...r),this[n]=!0,this._applyEditsHandler=i=>{const{serviceUrl:s,layerId:d,gdbVersion:l,mayReceiveServiceEdits:c,result:u}=i,m=s===this.url,h=d!=null&&this.layerId!=null&&d===this.layerId,V=b(this),R=b(this)&&f(s,l,this.gdbVersion);if(!m||V&&!R||!h&&!c)return;const S=u.then(e=>{var y;if(h&&(e.addedFeatures.length||e.updatedFeatures.length||e.deletedFeatures.length||e.addedAttachments.length||e.updatedAttachments.length||e.deletedAttachments.length))return this.emit("edits",p(e)),e;const I=(y=e.editedFeatures)==null?void 0:y.find(({layerId:F})=>F===this.layerId);if(I){const{adds:F,updates:M,deletes:_}=I.editedFeatures,v={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:F?F.map(({attributes:o})=>({objectId:this.objectIdField&&o[this.objectIdField],globalId:this.globalIdField&&o[this.globalIdField]})):[],deletedFeatures:_?_.map(({attributes:o})=>({objectId:this.objectIdField&&o[this.objectIdField],globalId:this.globalIdField&&o[this.globalIdField]})):[],updatedFeatures:M?M.map(({current:{attributes:o}})=>({objectId:this.objectIdField&&o[this.objectIdField],globalId:this.globalIdField&&o[this.globalIdField]})):[],editedFeatures:p(e.editedFeatures),exceededTransferLimit:!1,historicMoment:p(e.historicMoment)};return this.emit("edits",v),v}return{edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:[],deletedFeatures:[],updatedFeatures:[],editedFeatures:p(e.editedFeatures),exceededTransferLimit:!1,historicMoment:p(e.historicMoment)}}).then(e=>("historicMoment"in this&&this.historicMoment!==e.historicMoment&&U(s,l)&&(this.historicMoment=e.historicMoment),e));this.emit("apply-edits",{result:S})},this._updateMomentHandler=i=>{const{serviceUrl:s,gdbVersion:d,moment:l}=i,c=s===this.url,u=b(this),m=b(this)&&f(s,d,this.gdbVersion),h=b(this)&&!f(s,this.gdbVersion,null);c&&u&&m&&h&&"historicMoment"in this&&this.historicMoment!==l&&(this.historicMoment=l)},this.when().then(()=>{this.addHandles(D(this._applyEditsHandler)),"historicMoment"in this&&this.addHandles(O(this._updateMomentHandler))},()=>{})}};return n=A,a=$([x(w)],a),a};export{q as F,U as a,C as c,K as p,k as r,B as s};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./deleteForwardEdits-Csh5R32j.js","./index-eSY5-lt-.js","./index-5m03CWEM.css","./DeleteForwardEditsParameters-77VhraqZ.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}