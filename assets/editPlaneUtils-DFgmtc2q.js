import{W as n,X as r,Y as x,aN as Ot,a0 as st,dP as St,jL as rt,dY as at,dH as tt,b4 as zt,qp as Ft,qq as Ht,aA as Mt,oT as M,eC as V,qr as Nt,j2 as qt,iA as Lt,qs as Zt,qt as Dt,nJ as jt,qu as Yt,dO as Kt,jV as Qt,iK as kt,gw as Jt,fG as Wt,Z as Xt,i7 as lt,a2 as J,a3 as Bt,Q as q,oC as te,qv as ct,qw as ee,qx as pt,qy as ie,qz as oe,qA as dt,qB as ne,qC as se,iM as re,gk as ae,is as T,qD as S,nQ as ht,qE as le,qF as ce,ar as pe,oJ as W,oK as ut,qG as de,qH as he,qI as ue,qJ as ye,a$ as ge,aV as me,fx as yt,kA as gt,aU as mt,qK as vt}from"./index-BdDnxAOC.js";import{r as G,j as ve,f as fe,c as we,m as D,R as _e,k as Oe,L as ke,G as xe,g as $e}from"./automaticLengthMeasurementUtils-TATMKOid.js";import{h as j,k as be,R as Ue,y as xt,F as $t,Q as Ve,w as Ie,u as bt}from"./automaticAreaMeasurementUtils-C_4lG3ak.js";import{W as Te,K as Y}from"./boundedPlane-CkcDH2eT.js";var g;(function(t){t[t.NeverApplied=0]="NeverApplied",t[t.Applied=1]="Applied",t[t.Undone=2]="Undone"})(g||(g={}));var _;(function(t){t.UndoRedoUpdating="UndoRedoUpdating",t.UndoInvalidError="UndoInvalidError",t.RedoInvalidError="RedoInvalidError",t.ApplyInvalidError="ApplyInvalidError"})(_||(_={}));const K={[_.UndoRedoUpdating]:"Cannot perform operation whilst undo redo is updating",[_.UndoInvalidError]:"There are no items to Undo",[_.RedoInvalidError]:"There are no items to Redo",[_.ApplyInvalidError]:"Cannot apply an item that is already applied"};let z=class extends Error{constructor(){super(K[_.UndoRedoUpdating]),this.type="undo-redo-updating-error"}},B=class extends Error{constructor(){super(K[_.UndoInvalidError]),this.type="undo-redo-undo-error"}},ft=class extends Error{constructor(){super(K[_.RedoInvalidError]),this.type="undo-redo-redo-error"}},Re=class extends Error{constructor(){super(K[_.ApplyInvalidError]),this.type="undo-redo-apply-error"}};var k;(function(t){t[t.Apply=0]="Apply",t[t.Undo=1]="Undo",t[t.Redo=2]="Redo"})(k||(k={}));let L=class extends Ot{constructor(){super(...arguments),this.name="",this.tag=Symbol(),this.status=g.NeverApplied}get canUndo(){return this.status===g.Applied}get canRedo(){return this.status===g.Undone}async executeUndoRedoOperation(e){switch(e){case k.Apply:if(this.status!==g.NeverApplied)throw new Re;return await this.apply(),void(this.status=g.Applied);case k.Undo:if(this.status!==g.Applied)throw new B;return await this.undo(),void(this.status=g.Undone);case k.Redo:if(this.status!==g.Undone)throw new B;return await this.redo(),void(this.status=g.Applied)}}};n([r()],L.prototype,"name",void 0),n([r()],L.prototype,"tag",void 0),L=n([x("esri.undoredo.UndoableOperation")],L);let w=class extends Ot{constructor(){super(...arguments),this._stack=new st,this._stackPosition=-1,this._updatingHandles=new St}get updating(){return this._updatingHandles.updating}get canUndo(){return this.hasUndo&&!this.updating}get hasUndo(){return this._stackPosition>=0}get canRedo(){return this.hasRedo&&!this.updating}get hasRedo(){return this._stackPosition<this._stack.length-1}_truncateForwardStack(){this._stack.splice(this._stackPosition+1,this._stack.length-this._stackPosition).forEach(t=>t.destroy())}_drainStack(){this._stack.drain(t=>t.destroy()),this._stackPosition=-1}async undo(){if(!this.hasUndo)throw new B;if(this.updating)throw new z;const t=this._stack.getItemAt(this._stackPosition);t&&await this._updatingHandles.addPromise((async()=>{await t.executeUndoRedoOperation(k.Undo),--this._stackPosition,t.canRedo||this._truncateForwardStack()})())}async redo(){if(!this.hasRedo)throw new ft;if(this.updating)throw new z;const t=this._stack.getItemAt(this._stackPosition+1);if(!t)throw new ft;await this._updatingHandles.addPromise((async()=>{await t.executeUndoRedoOperation(k.Redo),++this._stackPosition})())}peekUndo(){if(this.canUndo)return this._stack.getItemAt(this._stackPosition)}peekRedo(){if(this.canRedo)return this._stack.getItemAt(this._stackPosition+1)}async inject(t){if(this.updating)throw new z;await this._updatingHandles.addPromise((async()=>{t.status===g.NeverApplied&&await t.executeUndoRedoOperation(k.Apply),t.canUndo?(this._stack.splice(this._stackPosition+1,0,t),this._stackPosition++):this._stackPosition>-1&&(this._stack.splice(0,this._stackPosition+1).forEach(e=>e.destroy()),this._stackPosition=-1)})())}async add(t){if(this.updating)throw new z;await this._updatingHandles.addPromise((async()=>{t.status===g.NeverApplied&&await t.executeUndoRedoOperation(k.Apply),this._stackPosition>=-1&&this._truncateForwardStack(),t.canUndo?(this._stack.push(t),this._stackPosition=this._stack.length-1):this._drainStack()})())}async removeTagged(t,e=!1){if(this.updating&&!e)return;await rt(()=>!this.updating);const i=new st;for(let o=0;o<this._stack.length;o++){const s=this._stack.getItemAt(o);s&&(s.tag===t?(s.destroy(),o===this._stackPosition&&(this._stackPosition=i.length-1)):i.push(s))}this._stack=i,this._stackPosition>i.length-1&&(this._stackPosition=i.length-1)}async clear(t=!1){if(this.updating&&!t)throw new z;await rt(()=>!this.updating),this._drainStack()}};n([r()],w.prototype,"_stack",void 0),n([r()],w.prototype,"_stackPosition",void 0),n([r()],w.prototype,"updating",null),n([r({readOnly:!0})],w.prototype,"canUndo",null),n([r({readOnly:!0})],w.prototype,"hasUndo",null),n([r({readOnly:!0})],w.prototype,"canRedo",null),n([r({readOnly:!0})],w.prototype,"hasRedo",null),w=n([x("esri.UndoRedo")],w);class Ce{constructor(){this.committedVertices=null,this.cursorVertex=null,this.full=null,this.outline=null,this.cursorEdge=null,this.circle=null,this.rectangle=null}}function et(t,e){switch(t){case"point":case"multipoint":return Ge();case"polyline":return Pe(e);case"polygon":return Ae(e);default:return}}function Ge(t){return"point"}function Pe(t){return(t!=null&&t.type==="polyline"&&t.paths.length?t.paths[0].length:0)<2?"polylineZeroVertices":"polylineOneVertex"}function Ae(t){const e=t!=null&&t.type==="polygon"&&t.rings.length?t.rings[0].length:0;return e<3?"polylineZeroVertices":e<4?"polygonOneVertex":"polygonTwoVertices"}function Ee(t,e){const i=t==null?void 0:t.geometry;if(!t||(i==null?void 0:i.type)!=="mesh"||!e)return;const{renderCoordsHelper:o,elevationProvider:s}=e,{camera:a}=e.state,{extent:c}=i,{center:u,spatialReference:l}=c,h=at(l),y=tt(l),m=at(o.spatialReference),U=c.width*h,d=c.height*y,I=(c.zmax??0)*y,A=I-(c.zmin??0)*y,N=Math.max(U,d,A)/m,{x:f,y:$}=u,E=u.z??0;zt(Z,f,$,E),o.toRenderCoords(Z,l,Z);const nt=N/a.computeScreenPixelSizeAt(Z);if(nt>a.width*ze)return"meshTooClose";if(nt<Se)return"meshTooFar";const At=Ft(t),{absoluteZ:Et}=Ht(f,$,I,l,e,At);return Et<(s.getElevation(f,$,E,l,"ground")??0)*y+A*Fe?"meshUnderground":"mesh"}const Se=20,ze=1,Fe=.1,Z=Mt();let O=class extends G{constructor(e){super(e),this.type="draw-circle",this.radius=null,this.xSize=null,this.ySize=null,this.area=M}get allFields(){return[]}};n([r()],O.prototype,"type",void 0),n([r()],O.prototype,"radius",void 0),n([r()],O.prototype,"xSize",void 0),n([r()],O.prototype,"ySize",void 0),n([r()],O.prototype,"area",void 0),n([r()],O.prototype,"allFields",null),O=n([x("esri.views.interactive.tooltip.infos.DrawCircleTooltipInfo")],O);let F=class extends j(G){constructor(e){super(e),this.type="draw-mesh",this.orientation=be({lockable:!1}),this.scale=Ue({lockable:!1})}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}};n([r()],F.prototype,"helpMessage",void 0),n([r()],F.prototype,"allFields",null),F=n([x("esri.views.interactive.tooltip.infos.DrawMeshTooltipInfo")],F);let H=class extends j(G){constructor(t){super(t),this.type="draw-point"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};n([r()],H.prototype,"helpMessage",void 0),n([r()],H.prototype,"allFields",null),H=n([x("esri.views.interactive.tooltip.infos.DrawPointTooltipInfo")],H);let R=class extends j(G){constructor(e){super(e),this.type="draw-polygon",this.direction=xt(),this.distance=$t(),this.area=Ve(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.area]}};n([r()],R.prototype,"xyMode",void 0),n([r()],R.prototype,"helpMessage",void 0),n([r()],R.prototype,"allFields",null),R=n([x("esri.views.interactive.tooltip.infos.DrawPolygonTooltipInfo")],R);let C=class extends j(G){constructor(t){super(t),this.type="draw-polyline",this.direction=xt(),this.distance=$t(),this.totalLength=Ie(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.totalLength]}};n([r()],C.prototype,"helpMessage",void 0),n([r()],C.prototype,"xyMode",void 0),n([r()],C.prototype,"allFields",null),C=n([x("esri.views.interactive.tooltip.infos.DrawPolylineTooltipInfo")],C);let b=class extends G{constructor(t){super(t),this.type="draw-rectangle",this.xSize=V,this.ySize=V,this.area=M}get allFields(){return[]}};n([r()],b.prototype,"type",void 0),n([r()],b.prototype,"xSize",void 0),n([r()],b.prototype,"ySize",void 0),n([r()],b.prototype,"area",void 0),n([r()],b.prototype,"allFields",null),b=n([x("esri.views.interactive.tooltip.infos.DrawRectangleTooltipInfo")],b);function He(t,e){return{point:new H({sketchOptions:e,viewType:t}),polyline:new C({sketchOptions:e,viewType:t}),polygon:new R({sketchOptions:e,viewType:t}),mesh:new F({sketchOptions:e,viewType:t}),rectangle:new b({sketchOptions:e}),circle:new O({sketchOptions:e})}}function wt(t){const{directionOptions:e,geometryType:i,sketchOptions:o,tooltipInfos:s}=t,a=u=>{const l=Q(t).mode,h=s[u].elevation;l==="relative-to-ground"||l==="relative-to-scene"||l==="on-the-ground"?h.lock(ot(t)):h.unlock()},c=u=>{if(e){const l=s[u].direction;l.committed=e.angle,l.unlockOnVertexPlacement=!1,o.values.directionMode=e.mode}};switch(i){case"polygon":case"polyline":a(i),c(i);break;case"point":case"mesh":a(i)}}function Me(t,e){const{drawOperation:i,view:o}=e,s=it(e),a=Q(e);if(o.type==="2d"||!t||a.mode!=="absolute-height"||(i==null?void 0:i.numCommittedVertices)!==1||!s||s.type!=="draw-polyline"&&s.type!=="draw-polygon"||s.elevation.locked)return;const[c,u,l]=t,h=Xe(c,u,l,a,e);h!=null&&s.elevation.lock(h)}function _t(t){var e;(e=it(t))==null||e.allFields.forEach(i=>{i.unlockOnVertexPlacement&&i.unlock()})}function it({geometryType:t,graphic:e,tooltipInfos:i}){var o;return t==="multipoint"||((o=e==null?void 0:e.geometry)==null?void 0:o.type)!==Ne[t]?null:i[t]}const Ne={point:"point",mesh:"mesh",polyline:"polyline",polygon:"polygon",circle:"polygon",rectangle:"polygon"};function qe(t,e){switch(t==null?void 0:t.type){case"draw-point":Le(t,e);break;case"draw-polyline":De(t,e);break;case"draw-polygon":je(t,e);break;case"draw-rectangle":Ke(t,e);break;case"draw-circle":Qe(t,e);break;case"draw-mesh":Ze(t,e)}}function Le(t,e){var o;const i=(o=e.graphic)==null?void 0:o.geometry;(i==null?void 0:i.type)==="point"&&(Ut(t,i,e),t.helpMessage=et("point",i))}function Ze(t,e){const{graphic:i,view:o}=e,s=i==null?void 0:i.geometry;o.type!=="3d"||s&&s.type!=="mesh"||(Ut(t,s==null?void 0:s.origin,e),s&&fe(t,s),t.helpMessage=Ee(i,o))}function Ut(t,e,i){const{drawOperation:o,view:s,sketchOptions:a}=i,{cursorVertex:c}=o;if(t.sketchOptions=a,t.viewType=s.type,t.setLocationFromPoint(e,P(i)),It(t.elevation,i),!c)return void(o.constraints=void 0);const u=c;o.constraints={context:Gt(u,i),x:t.x.committed,y:t.y.committed,longitude:t.longitude.committed,latitude:t.latitude.committed,elevation:t.elevation.committed,distance:null,direction:null}}function De(t,e){const{createOperationGeometry:i,drawOperation:o}=e,s=i!=null?i.full:null;s&&s.type!=="polyline"||(Vt(t,e),t.totalLength.actual=o.lastVertex?(s?we(s):null)??V:null,t.helpMessage=et("polyline",s))}function je(t,e){const{createOperationGeometry:i,drawOperation:o}=e,s=i!=null?i.full:null;s&&s.type!=="polygon"||(Vt(t,e),t.area.actual=o.lastVertex?(s?bt(s):null)??M:null,t.helpMessage=et("polygon",s))}function Vt(t,e){const{drawOperation:i,sketchOptions:o,view:s}=e,{cursorVertex:a,lastVertex:c,secondToLastVertex:u}=i,l=o.values.effectiveDirectionMode;t.sketchOptions=o,t.viewType=s.type;const h=c&&a?D(c,a)??V:null;if(t.distance.actual=h,t.distance.readOnly=c==null,t.direction.actual=null,t.direction.readOnly=!0,c&&a&&(l==="absolute"||u)){const U=Zt(u,c,a,l);t.direction.actual=U??Dt,t.direction.readOnly=!1}t.setLocationFromPoint(a,P(e)),It(t.elevation,e);const y=Ye(c,e);t.xyMode=y,t.direction.visible=y==="direction-distance",t.distance.visible=y==="direction-distance",t.effectiveX.visible=y==="coordinates",t.effectiveY.visible=y==="coordinates";const m=a??c;i.constraints=m?{context:Gt(m,e),x:t.x.committed,y:t.y.committed,longitude:t.longitude.committed,latitude:t.latitude.committed,elevation:t.elevation.committed,distance:t.distance.committed,direction:t.direction.committed}:void 0}function Ye(t,{sketchOptions:e}){const i=e.tooltips.xyMode;return i==="auto"?t?"direction-distance":"coordinates":i}function Ke(t,e){t.sketchOptions=e.sketchOptions,t.xSize=Rt(e),t.ySize=Ct(e),t.area=Tt(e)}function Qe(t,e){const{forceUniformSize:i,sketchOptions:o}=e;t.sketchOptions=o,t.radius=i?Je(e):null,t.xSize=i?null:Rt(e),t.ySize=i?null:Ct(e),t.area=Tt(e)}function It(t,e){const{drawOperation:i}=e,o=(i==null?void 0:i.cursorVertex)??(i==null?void 0:i.lastVertex);t.actual=_e(o)??ot(e),t.visible=i.hasZ,t.readOnly=!1,t.showAsZ=!0}function Tt(t){var i;const e=(i=t.createOperationGeometry)==null?void 0:i.full;return(e==null?void 0:e.type)!=="polygon"?M:bt(e)??M}function Rt(t){var i,o;const e=(o=(i=t.createOperationGeometry)==null?void 0:i.rectangle)==null?void 0:o.midpoints;return(e!=null?D(e.left,e.right):null)??V}function Ct(t){var i,o;const e=(o=(i=t.createOperationGeometry)==null?void 0:i.rectangle)==null?void 0:o.midpoints;return(e!=null?D(e.top,e.bottom):null)??V}function Je({createOperationGeometry:t}){var e;return(((e=t==null?void 0:t.circle)==null?void 0:e.center)!=null&&t.circle.edge!=null?D(t.circle.center,t.circle.edge):null)??V}function We(t){const{geometryType:e,tooltipInfos:i}=t;switch(e){case"point":case"mesh":case"polyline":case"polygon":{const o=i[e].elevation.committed;return o?jt(o,"meters")/tt(P(t)):void 0}default:return}}function Xe(t,e,i,o,s){const{view:a,drawOperation:c}=s;if(a.type!=="3d"||!c)return;i??(i=0);const u=P(s),l=Q(s),h=Nt(a,t,e,i,u,l,o);return ve(h,u)??ot(s)}function Q(t){return t.drawOperation.elevationInfo??qt}function P(t){return t.drawOperation.coordinateHelper.spatialReference}function ot(t){const e=tt(P(t));return Lt(t.defaultZ*e,"meters")}function Gt(t,e){return Yt(t,e.view,P(e),Q(e),e.drawOperation.coordinateHelper.hasZ(),e.sketchOptions.values.effectiveDirectionMode)}let p=class extends Kt.EventedMixin(Qt){constructor(t){super(t),this._graphic=null,this._coordinateFormatterLoadTask=null,this._createOperationGeometry=null,this.defaultZ=0,this.directionOptions=null,this.geometryType=null,this.hasZ=!0,this.geometryToPlace=null,this.snappingManager=null,this.snapToScene=!1,this.sketchOptions=new kt}initialize(){const{view:t}=this;this.internalGraphicsLayer=new Jt({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer);const e=this.drawOperation=this.makeDrawOperation();this.tooltipInfos=He(t.type,this.sketchOptions);const i=Oe(()=>({view:t,options:this.sketchOptions.tooltips}));this.tooltip=i,wt(this._tooltipsContext),this._coordinateFormatterLoadTask=Wt(()=>$e()),this.addHandles([e.on("vertex-add",o=>this.onVertexAdd(o)),e.on("vertex-remove",o=>this.onVertexRemove(o)),e.on("vertex-update",o=>this.onVertexUpdate(o)),e.on("cursor-update",o=>this.onCursorUpdate(o)),e.on("cursor-remove",()=>this._updateGraphic()),e.on("complete",o=>this.onComplete(o)),this._coordinateFormatterLoadTask,i.on("paste",o=>ke(o,this.activeTooltipInfo)),Xt(()=>this.cursor,o=>{e.cursor=o},re),lt(()=>{const{activeTooltipInfo:o,sketchOptions:s}=this;qe(o,this._tooltipsContext),i.info=s.tooltips.effectiveEnabled?o:null}),lt(()=>{e.constraintZ=We(this._tooltipsContext)},ae)]),this.finishToolCreation()}destroy(){this.drawOperation=J(this.drawOperation),this.tooltip=J(this.tooltip),this._destroyAllVisualizations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=J(this.internalGraphicsLayer),this._set("view",null)}get _drawSpatialReference(){return this.drawOperation.coordinateHelper.spatialReference}get _tooltipsContext(){return{createOperationGeometry:this._createOperationGeometry,defaultZ:this.defaultZ,directionOptions:this.directionOptions,drawOperation:this.drawOperation,forceUniformSize:this.forceUniformSize,geometryType:this.geometryType,graphic:this.graphic,sketchOptions:this.sketchOptions,tooltipInfos:this.tooltipInfos,view:this.view}}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(t){this._set("centered",t),this._updateGraphic()}get cursor(){return this._get("cursor")}set cursor(t){this._set("cursor",t)}set enabled(t){this.drawOperation.interactive=t,this._set("enabled",t)}set forceUniformSize(t){this._set("forceUniformSize",t),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(t){this._set("graphicSymbol",t),this._graphic!=null&&(this._graphic.symbol=t)}set mode(t){const e=this.drawOperation;e&&(e.drawingMode=t),this._set("mode",t)}get updating(){var t;return((t=this.drawOperation)==null?void 0:t.updating)??!1}get undoRedo(){const{view:{type:t,map:e}}=this;return t==="2d"&&e&&"undoRedo"in e&&e.undoRedo instanceof w?e.undoRedo:null}set undoRedo(t){this._override("undoRedo",t)}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(t){this.destroyed||xe(t,this.tooltip)||this.drawOperation.onInputEvent(t)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo(),this.drawOperation.numCommittedVertices===0&&wt(this._tooltipsContext)}_destroyAllVisualizations(){this.removeHandles(v.outline),this.removeHandles(v.regularVertices),this.removeHandles(v.activeVertex),this.removeHandles(v.activeEdge),this.removeHandles(X)}_createOrUpdateGraphic(t){if(this._graphic!=null)return this.updateGraphicGeometry(t),this._graphic;const e=new Bt({...this.graphicProperties,symbol:this.graphicSymbol});return this._graphic=e,this.updateGraphicGeometry(t),this.internalGraphicsLayer.add(e),this.addHandles(this.initializeGraphic(e)),this.notifyChange("graphic"),this.addHandles(q(()=>{this.internalGraphicsLayer.remove(e),this._graphic===e&&(this._graphic=null)}),X),e}updateGraphicGeometry(t){this._graphic.geometry=t}_getCreateOperationGeometry(t={operationComplete:!1}){var A,N;if(this.drawOperation==null)return;const{coordinateHelper:e,view:i,visualizationCursorVertex:o,lastVertex:s,committedVertices:a,geometryIncludingUncommittedVertices:c,numCommittedVertices:u}=this.drawOperation;if(!(u>0||o!=null))return;const l=t.operationComplete?a:c,h=l.length,y=o!=null?e.pointToArray(o):null,m=this._drawSpatialReference,U=i.type==="3d"&&i.viewingMode==="global",d=new Ce;d.committedVertices=a,d.cursorVertex=y;const{geometryType:I}=this;switch(I){case"point":case"mesh":d.full=e.arrayToPoint(l[0]);break;case"multipoint":d.full=h>0?se(l,m):null;break;case"polyline":case"polygon":h>0&&(d.full=I==="polygon"?oe([l],m,U,!0):dt([l],m,U),d.cursorEdge=y!=null&&s&&!ne(o,s)?dt([[y,e.pointToArray(s)]],m,U):null,d.outline=h>1?d.full:null);break;case"circle":case"rectangle":{if(d.committedVertices=d.cursorVertex=null,!h)break;const f=te(i,l[0]),$=l[0],E=f.makeMapPoint($[0]+Be*i.resolution,$[1]);I==="circle"?h===1&&t.operationComplete?d.circle=ct([$,E],f,!0):h===2&&(this.forceUniformSize?d.circle=ct(l,f,this.centered):d.rectangle=ee(l,f,this.centered)):h===1&&t.operationComplete?d.rectangle=pt([$,E],f,!0):h===2&&(d.rectangle=this.forceUniformSize?pt(l,f,this.centered):ie(l,f,this.centered)),d.full=d.circle!=null?d.circle.geometry:(A=d.rectangle)==null?void 0:A.geometry,d.outline=((N=d.full)==null?void 0:N.type)==="polygon"?d.full:null;break}default:return null}return d}initializeGraphic(t){return q()}onComplete(t){if(!this.drawOperation)return;this._updateGraphic();let e=null;if(this.drawOperation.isCompleted){const i=this._getCreateOperationGeometry({operationComplete:!0});i!=null&&(e=this._createOrUpdateGraphic(i.full))}this._createOperationGeometry=null,this.emit("complete",{graphic:e,...t})}onCursorUpdate(t){this._updateGraphic(),this.emit("cursor-update",t)}onDeactivate(){const{drawOperation:t}=this;t&&(t.isCompleted||t.cancel())}onOutlineChanged(t){return q()}onCursorEdgeChanged(t){return q()}onVertexAdd(t){var e;_t(this._tooltipsContext),this._updateGraphic(),Me((e=t.vertices.at(0))==null?void 0:e.coordinates,this._tooltipsContext),this.emit("vertex-add",t)}onVertexRemove(t){_t(this._tooltipsContext),this._updateGraphic(),this.emit("vertex-remove",t)}onVertexUpdate(t){this._updateGraphic(),this.emit("vertex-update",t)}_updateGraphic(){const t=this._getCreateOperationGeometry();this._createOperationGeometry=t,t!=null?(t.cursorEdge!=null?this.addHandles(this.onCursorEdgeChanged(t.cursorEdge),v.activeEdge):this.removeHandles(v.activeEdge),t.outline!=null?this.addHandles(this.onOutlineChanged(t.outline),v.outline):this.removeHandles(v.outline),t.committedVertices!=null?this.addHandles(this.onRegularVerticesChanged(t.committedVertices),v.regularVertices):this.removeHandles(v.regularVertices),t.cursorVertex!=null?this.addHandles(this.onActiveVertexChanged(t.cursorVertex),v.activeVertex):this.removeHandles(v.activeVertex),t.full!=null?this._createOrUpdateGraphic(t.full):this.removeHandles(X)):this._destroyAllVisualizations()}get activeTooltipInfo(){var t;return(t=this._coordinateFormatterLoadTask)!=null&&t.finished?it(this._tooltipsContext):null}};n([r()],p.prototype,"_coordinateFormatterLoadTask",void 0),n([r()],p.prototype,"_createOperationGeometry",void 0),n([r()],p.prototype,"_tooltipsContext",null),n([r({value:!0})],p.prototype,"centered",null),n([r()],p.prototype,"cursor",null),n([r({nonNullable:!0})],p.prototype,"defaultZ",void 0),n([r({constructOnly:!0})],p.prototype,"directionOptions",void 0),n([r()],p.prototype,"drawOperation",void 0),n([r({value:!0})],p.prototype,"enabled",null),n([r({value:!0})],p.prototype,"forceUniformSize",null),n([r({constructOnly:!0})],p.prototype,"geometryType",void 0),n([r()],p.prototype,"graphic",null),n([r({constructOnly:!0})],p.prototype,"graphicProperties",void 0),n([r()],p.prototype,"graphicSymbol",null),n([r({constructOnly:!0})],p.prototype,"hasZ",void 0),n([r({constructOnly:!0})],p.prototype,"geometryToPlace",void 0),n([r()],p.prototype,"mode",null),n([r()],p.prototype,"snappingManager",void 0),n([r()],p.prototype,"snapToScene",void 0),n([r()],p.prototype,"tooltip",void 0),n([r()],p.prototype,"tooltipInfos",void 0),n([r({constructOnly:!0,type:kt})],p.prototype,"sketchOptions",void 0),n([r()],p.prototype,"updating",null),n([r({constructOnly:!0,nonNullable:!0})],p.prototype,"view",void 0),n([r({constructOnly:!0})],p.prototype,"undoRedo",null),n([r()],p.prototype,"activeTooltipInfo",null),p=n([x("esri.views.draw.DrawGraphicTool")],p);const X=Symbol("create-operation-graphic"),v={outline:Symbol("outline-visual"),regularVertices:Symbol("regular-vertices-visual"),activeVertex:Symbol("active-vertex-visual"),activeEdge:Symbol("active-edge-visual")};function gi(t){switch(t){case"point":case"polyline":case"polygon":case"multipoint":return t;case"circle":case"rectangle":return"segment";case"mesh":return"point"}}const Be=48;function mi(t,e){return Pt(t,e,!1)}function vi(t,e){return Pt(t,e,!0)}function Pt(t,e,i){if(t instanceof de){if(t.operation instanceof he)return ti(t.operation,e,i),!0;if(t.operation instanceof ue)return ei(t.operation,e,i),!0;if(t.operation instanceof ye)return ii(t.operation,e,i),!0}return!1}function ti(t,e,i=!1){const o=i?-1:1,s=ge(o*t.dx,o*t.dy,o*t.dz);me(e.origin,e.origin,s),Y(e)}function ei(t,e,i=!1){const o=i?-t.angle:t.angle;yt(e.basis1,e.basis1,gt,o),yt(e.basis2,e.basis2,gt,o),Y(e)}function ii(t,e,i=!1){const o=i?1/t.factor1:t.factor1,s=i?1/t.factor2:t.factor2;mt(e.basis1,e.basis1,o),mt(e.basis2,e.basis2,s),vt(e.origin,e.origin,t.origin,t.axis1,o),vt(e.origin,e.origin,t.origin,t.axis2,s),Y(e)}function fi(t,e,i,o){o||(o=Te());const s=T(S.get(),t[1],-t[0]),a=T(S.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),c=T(S.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),u=S.get();e.components.forEach(y=>y.vertices.forEach(({pos:m})=>{T(u,ht(t,m),ht(s,m)),le(a,a,u),ce(c,c,u)}));const l=1e-6,h=T(S.get(),c[0]-a[0]<l?i/2:0,c[1]-a[1]<l?i/2:0);return pe(a,a,h),W(c,c,h),ut(o.basis1,t,(c[0]-a[0])/2),ut(o.basis2,s,(c[1]-a[1])/2),T(o.origin,a[0]*t[0]+a[1]*s[0],a[0]*t[1]+a[1]*s[1]),W(o.origin,o.origin,o.basis1),W(o.origin,o.origin,o.basis2),Y(o),o}export{vi as E,fi as F,p as I,gi as M,mi as d};
