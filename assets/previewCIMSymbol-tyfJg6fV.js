import{aI as w,aJ as v}from"./index-eSY5-lt-.js";import{b as O,n as g}from"./cimAnalyzer-DsuWkQlK.js";import{CIMSymbolRasterizer as j}from"./CIMSymbolRasterizer-rDLkJRGn.js";import{O as G}from"./utils-jQLeeGOF.js";import{t as b,l as R}from"./symbolUtils-5r1IAQ7f.js";import"./fontUtils-GE0ho--n.js";import"./BidiEngine-8z8MVveq.js";import"./labelPoint-mThgM4t0.js";import"./OptimizedGeometry-CbNXANBG.js";import"./GeometryUtils-CEMOhUyj.js";import"./enums--FbEXJ87.js";import"./alignmentUtils-XT3TYmYW.js";import"./definitions-otzk_d_r.js";import"./number-sTjsTbdA.js";import"./Rect-pT1ASav_.js";import"./callExpressionWithFeature-rytrJuuz.js";import"./quantizationUtils-DTwa03mn.js";import"./floatRGBA-9E5qKLsz.js";import"./CIMResourceManager-RJnqsZ6j.js";import"./imageUtils-tXDgLQzN.js";import"./Rasterizer-JVG-pIoh.js";import"./rasterizingUtils-vy6gAIzi.js";import"./cimSymbolUtils-i5s4LTBQ.js";import"./ColorStop-y1faJUUg.js";import"./utils-NbMqmVX1.js";import"./LRUCache-mFQSPLKh.js";import"./utils-ogjc0K8k.js";import"./jsonUtils-M3inctU9.js";import"./UniqueValueRenderer-hljh8Sos.js";import"./LegendOptions-x-5oaDqO.js";import"./diffUtils-x5OXhJZZ.js";import"./SizeVariable-221gAT5i.js";import"./colorRamps-rojoPCoV.js";import"./jsonUtils-1IxKPsH1.js";import"./styleUtils-BMYfqyTs.js";import"./DictionaryLoader-W3_-N3pK.js";import"./Version-DuGO31mq.js";import"./FieldsIndex-_W1Us-oq.js";import"./UnknownTimeZone-iVS1S_Kf.js";import"./heatmapUtils-QdzYLNxE.js";import"./colorUtils-d-fcXxMg.js";import"./webStyleSymbolUtils-kjfVwPY4.js";import"./devEnvironmentUtils-3qgG8Z2w.js";const u=new j(null,!0),c=w(b.size),S=w(b.maxSize),C=w(b.lineWidth),V=1;async function $(o,t,a){const i=t==null?void 0:t.size;let e=i!=null&&typeof i=="object"&&"width"in i?i.width:i,l=i!=null&&typeof i=="object"&&"height"in i?i.height:i;if(e==null||l==null)if(a==="esriGeometryPolygon")e=c,l=c;else{const r=await q(o,t,a);r&&(e=r.width,l=r.height),a==="esriGeometryPolyline"&&(e=C),e=e!=null&&isFinite(e)?Math.min(e,S):c,l=l!=null&&isFinite(l)?Math.max(Math.min(l,S),V):c}return t.style==="legend"&&a==="esriGeometryPolyline"&&(e=C),{width:e,height:l}}async function q(o,t,a){const{feature:i,fieldMap:e,viewParams:l}=t.cimOptions||t,r=await O.resolveSymbolOverrides(o.data,i,null,e,a,null,l);if(!r)return null;(o=o.clone()).data={type:"CIMSymbolReference",symbol:r},o.data.primitiveOverrides=void 0;const n=[];return g.fetchResources(r,u.resourceManager,n),g.fetchFonts(r,u.resourceManager,n),n.length>0&&await Promise.all(n),g.getEnvelope(r,null,u.resourceManager)}async function Lt(o,t={}){var M;const{node:a,opacity:i,symbolConfig:e}=t,l=e!=null&&typeof e=="object"&&"isSquareFill"in e&&e.isSquareFill,r=t.cimOptions||t,n=r.geometryType||G((M=o==null?void 0:o.data)==null?void 0:M.symbol),f=await $(o,t,n),{feature:I,fieldMap:P}=r,L=l||n!=="esriGeometryPolygon"?"preview":"legend",h=await u.rasterizeCIMSymbolAsync(o,I,f,L,P,n,null,r.viewParams,r.allowScalingUp);if(!h)return null;const{width:x,height:z}=h,p=document.createElement("canvas");p.width=x,p.height=z,p.getContext("2d").putImageData(h,0,0);const y=v(f.width),d=v(f.height),m=new Image(y,d);m.src=p.toDataURL(),m.ariaLabel=t.ariaLabel??null,m.alt=t.ariaLabel??"",i!=null&&(m.style.opacity=`${i}`);let s=m;if(t.effectView!=null){const F={shape:{type:"image",x:0,y:0,width:y,height:d,src:m.src},fill:null,stroke:null,offset:[0,0]};s=R([[F]],[y,d],{effectView:t.effectView,ariaLabel:t.ariaLabel})}return a&&s&&a.appendChild(s),s}export{Lt as previewCIMSymbol};
