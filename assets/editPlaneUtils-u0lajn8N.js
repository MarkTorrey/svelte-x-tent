import{f as Ae,a$ as k,m9 as Nt,ma as Ue,mb as Ze,cz as b,dy as qt,d9 as lt,cG as Et,cF as We,cD as de,da as ge,dc as Le,dT as Xt,v as it,b2 as Ne,b1 as qe,mc as ye,ah as At,fD as Xe,b0 as je,h2 as Ye,a7 as me,i5 as Qe,md as Be,ca as Je,me as Ke,V as tn,l as s,ag as ft,mf as F,aa as en,k as nn,m as l,n as M,j6 as on,mg as an,mh as rn,cy as sn,cR as Vt,d2 as ln,mi as pn,mj as cn,mk as un,ml as hn,gB as ct,bm as jt,mm as dn,mn as Yt,mo as ut,dX as gn,cU as yn,mp as mn,mq as fn,mr as vn,ms as _n,dL as xn,gC as wn,c4 as Ut,mt as vt,ed as _t,eh as bn,o as W,gN as Tn,u as D,mu as Sn,t as $n,e as Qt,mv as Zt,bX as Mn,eq as ht,mw as dt,c1 as xt,dS as fe,cB as On,aF as Bt,en as ve,mx as Pn,f4 as _e,my as xe,ei as Ct,j8 as we,gO as Rt,g7 as be,c5 as In,mz as En,mA as Vn,mB as Cn,js as Rn,ib as Jt,g$ as Te,cN as zn,cH as Gn,mC as Kt,i_ as te,m8 as ee,gX as q,mD as tt,m6 as ne,mE as Dn,mF as kn,e9 as Fn,mG as $t,mH as ie}from"./index-eSY5-lt-.js";import{t as et}from"./memoize-uBdPJ80n.js";import{o as gt,g as zt,s as Se,h as P,i as yt,f as Wt,U as $e,d as Y,l as Hn}from"./unitFormatUtils-14JHbQwR.js";import{simplify as An,distance as Un}from"./geometryEngine-OntNUgGF.js";import{Q as Zn,L as Wn}from"./quat-7g9K7sUG.js";import{t as Gt}from"./projectVectorToVector-EjL4REoi.js";import"./spatialReferenceEllipsoidUtils-C7ZdwAmG.js";import{J as wt,W as Ln}from"./boundedPlane-l8xUIJF_.js";import{o as oe,i as Me,s as Q,p as Nn,d as qn,a as Mt,u as Xn}from"./Tooltip-xhgZnGbx.js";import{o as ae,e as Dt,w as jn,V as Yn,p as Qn,l as Bn,t as Jn,b as Kn,s as ti,c as ei}from"./SnappingContext-Gx6YYzw1.js";import{a as ni}from"./diffUtils-x5OXhJZZ.js";import{k as ii,a as oi,x as bt}from"./interfaces-uUGzHEiK.js";import{r as Oe}from"./GraphicManipulator-223uhWDV.js";function kt(e,t){return e===t||e!=null&&t!=null&&Ae(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}function mt(e,t,n=null){return n!=null?[e,t,n]:[e,t]}function _(e,t,n=null){return n!=null?{x:e,y:t,z:n}:{x:e,y:t}}let Pe=class{constructor(t){this.spatialReference=t}mapToLocalMultiple(t){return t.map(n=>this.mapToLocal(n)).filter(it)}get doUnnormalization(){return!1}},ai=class extends Pe{constructor(t,n,i=null){super(n),this._defaultZ=i,this.transform=Nt(),this.transformInv=Nt(),this.transform=Ue(t),Ze(this.transformInv,this.transform)}makeMapPoint(t,n){return mt(t,n,this._defaultZ)}mapToLocal(t){return _(this.transform[0]*t[0]+this.transform[2]*t[1]+this.transform[4],this.transform[1]*t[0]+this.transform[3]*t[1]+this.transform[5])}localToMap(t){return mt(this.transformInv[0]*t.x+this.transformInv[2]*t.y+this.transformInv[4],this.transformInv[1]*t.x+this.transformInv[3]*t.y+this.transformInv[5],this._defaultZ)}},ri=class extends Pe{constructor(t,n){super(t.spatialReference),this.view=t,this.defaultZ=null,this.pWS=b(),this.tangentFrameUpWS=b(),this.tangentFrameRightWS=b(),this.tangentFrameForwardWS=b(),this.localFrameRightWS=b(),this.localFrameUpWS=b(),this.worldToLocalTransform=qt(),this.localToWorldTransform=qt(),this.scale=1,this.scale=t.resolution,this.referenceMapPoint=n,this.defaultZ=n.hasZ?n.z:null;const i=t.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,lt.X,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,lt.Y,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,lt.Z,this.tangentFrameForwardWS);const o=b();Et(o,this.tangentFrameForwardWS,We(i,this.tangentFrameForwardWS)),de(this.localFrameRightWS,i,o),ge(this.localFrameRightWS,this.localFrameRightWS),Le(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),Zn(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),Wn(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return this.view.viewingMode==="global"}makeMapPoint(t,n){return mt(t,n,this.defaultZ)}mapToLocal(t){const n=b();this.view.renderCoordsHelper.toRenderCoords(new k({x:t[0],y:t[1],spatialReference:this.spatialReference}),n),Xt(n,n,this.worldToLocalTransform);const i=this.view.renderCoordsHelper.fromRenderCoords(n,this.view.spatialReference);return i!=null?_(i.x/this.scale,i.y/this.scale):null}localToMap(t){const n=b();this.view.renderCoordsHelper.toRenderCoords(new k({x:t.x*this.scale,y:t.y*this.scale,spatialReference:this.spatialReference}),n),Xt(n,n,this.localToWorldTransform);const i=this.view.renderCoordsHelper.fromRenderCoords(n,this.view.spatialReference);return i!=null?mt(i.x,i.y,this.defaultZ):null}};function re(e,t){if(e.type==="2d")return new ai(e.state.transform,e.spatialReference,t.length>2?t[2]:null);if(e.type==="3d"){const n=t.length>2?new k({x:t[0],y:t[1],z:t[2],spatialReference:e.spatialReference}):new k({x:t[0],y:t[1],spatialReference:e.spatialReference});return new ri(e,n)}return null}function L(e,t){const n=new k({x:e[0],y:e[1],spatialReference:t});return e.length>2&&(n.z=e[2]),n}function si(e,t){return new Ne({points:e,spatialReference:t})}function se(e,t,n){const i=new qe({paths:e,spatialReference:t});return n&&ye(i),i}function N(e,t,n,i=!0){const o=At(e);o.forEach(r=>{const c=r[0],p=r[r.length-1];Xe(c,p)&&r.length!==1||r.push(r[0])});let a=new je({rings:o,spatialReference:t});return a.rings.forEach(r=>{Ye(r)||r.reverse()}),n&&ye(a),i&&a.isSelfIntersecting&&me(t)&&(a=An(a)),a}function le(e,t,n){const i=t.mapToLocalMultiple(e),o=[],a={x:i[0].x,y:i[0].y},r={x:i[1].x,y:i[1].y},c=Math.round(r.x-a.x),p=Math.round(r.y-a.y),u=Math.max(Math.abs(c),Math.abs(p));if(n){const d={x:a.x+u,y:a.y+u},g={x:a.x-u,y:a.y-u};o.push(_(d.x,g.y),_(g.x,g.y),_(g.x,d.y),_(d.x,d.y))}else{const d={x:c>0?a.x+u:a.x-u,y:p>0?a.y+u:a.y-u};o.push(_(a.x,a.y),_(d.x,a.y),_(d.x,d.y),_(a.x,d.y))}return Ie(N([o.map(d=>t.localToMap(d)).filter(it)],t.spatialReference,t.doUnnormalization,!0),o,t)}function li(e,t,n){let i=t.mapToLocalMultiple(e);if(i.length===1){const p=i[0];i=[_(p.x-48,p.y+48),_(p.x+48,p.y-48),_(p.x+48,p.y-48),_(p.x-48,p.y+48)]}const o=[],a={x:i[0].x,y:i[0].y},r={x:i[1].x,y:i[1].y};if(n){const c=Math.round(r.x-a.x),p=Math.round(r.y-a.y);o.push(_(a.x-c,a.y-p),_(r.x,a.y-p),_(r.x,r.y),_(a.x-c,r.y))}else o.push(_(a.x,a.y),_(r.x,a.y),_(r.x,r.y),_(a.x,r.y));return Ie(N([o.map(c=>t.localToMap(c)).filter(it)],t.spatialReference,t.doUnnormalization,!0),o,t)}function Ie(e,t,n){const i=at(t[3],t[2],n),o=at(t[1],t[2],n),a=at(t[0],t[1],n),r=at(t[0],t[3],n);return{geometry:e,midpoints:i!=null&&o!=null&&a!=null&&r!=null?{top:i,right:o,bottom:a,left:r}:null}}function at(e,t,n){X[0]=e.x,X[1]=e.y,X[2]=0,j[0]=t.x,j[1]=t.y,j[2]=0,Qe(X,X,j,.5),rt.x=X[0],rt.y=j[1],rt.z=j[2];const i=n.localToMap(rt);return i!=null?L(i,n.spatialReference):null}const rt=_(0,0,0),X=b(),j=b();function pe(e,t,n,i){const o=t.mapToLocalMultiple(e);let a=null,r=null;if(n)a=o[0],r=o[1];else{const v=o[0],m=o[1],S=Math.round(m.x-v.x),O=Math.round(m.y-v.y),$=Math.max(Math.abs(S),Math.abs(O));a=_(S>0?v.x+$/2:v.x-$/2,O>0?v.y+$/2:v.y-$/2),r=_(Math.abs(S)>Math.abs(O)?a.x-$/2:a.x,Math.abs(S)>Math.abs(O)?a.y:a.y-$/2)}const c=t.localToMap(a),p=t.localToMap(r);if(c==null||p==null)return null;t.doUnnormalization&&Be([[c,p]],t.spatialReference);const u=L(c,t.spatialReference),d=L(p,t.spatialReference),g=Je(t.spatialReference);let h=0;if(me(t.spatialReference))h=g*Un(u,d,null);else{const v=a.x-r.x,m=a.y-r.y;h=g*Math.sqrt(v*v+m*m)*(i||1)}const x=new Ke({center:u,radius:h,radiusUnit:"meters",spatialReference:t.spatialReference});return{geometry:N(x.rings,x.spatialReference,!1),center:u,edge:d}}function pi(e,t,n){const i=t.mapToLocalMultiple(e),o=i[0],a=i[1],r=Math.round(a.x-o.x),c=Math.round(a.y-o.y),p=_(n?o.x:o.x+r/2,n?o.y:o.y+c/2),u=n?r:r/2,d=n?c:c/2,g=60,h=[],x=2*Math.PI/g;function v(I){const K=Math.cos(I),ot=Math.sin(I);return _(u*K+p.x,d*ot+p.y)}for(let I=0;I<g;I++)h.push(v(I*x));h.push(h[0]);const{spatialReference:m,doUnnormalization:S}=t,O=N([h.map(I=>t.localToMap(I)).filter(it)],m,S,!1),$=t.localToMap(v(Math.PI/2)),z=t.localToMap(v(0)),B=t.localToMap(v(-Math.PI/2)),J=t.localToMap(v(Math.PI));return{geometry:O,midpoints:$!=null&&z!=null&&B!=null&&J!=null?{top:L($,m),right:L(z,m),bottom:L(B,m),left:L(J,m)}:null}}function Ot(e,t){switch(e){case"point":case"multipoint":return ci();case"polyline":return ui(t);case"polygon":return hi(t);default:return}}function ci(e){return"point"}function ui(e){return(e!=null&&e.type==="polyline"&&e.paths.length?e.paths[0].length:0)<2?"polylineZeroVertices":"polylineOneVertex"}function hi(e){const t=e!=null&&e.type==="polygon"&&e.rings.length?e.rings[0].length:0;return t<3?"polylineZeroVertices":t<4?"polygonOneVertex":"polygonTwoVertices"}var Z;(function(e){e[e.WhenToolEditable=0]="WhenToolEditable",e[e.WhenToolNotEditable=1]="WhenToolNotEditable",e[e.Always=2]="Always"})(Z||(Z={}));class di{constructor(){this._isToolEditable=!0,this._manipulators=new tn,this._resourceContexts={manipulator3D:{}},this._attached=!1}set isToolEditable(t){this._isToolEditable=t}get length(){return this._manipulators.length}add(t,n=Z.WhenToolEditable){this.addMany([t],n)}addMany(t,n=Z.WhenToolEditable){for(const i of t){const o={manipulator:i,visibilityPredicate:n,attached:!1};this._manipulators.add(o),this._attached&&this._updateManipulatorAttachment(o)}}remove(t){for(let n=0;n<this._manipulators.length;n++)if(this._manipulators.at(n).manipulator===t){const i=this._manipulators.splice(n,1)[0];this._detachManipulator(i);break}}removeAll(){this._manipulators.forEach(t=>{this._detachManipulator(t)}),this._manipulators.removeAll()}attach(){this._manipulators.forEach(t=>{this._updateManipulatorAttachment(t)}),this._attached=!0}detach(){this._manipulators.forEach(t=>{this._detachManipulator(t)}),this._attached=!1}destroy(){this.detach(),this._manipulators.forEach(({manipulator:t})=>t.destroy()),this._manipulators.destroy(),this._resourceContexts=null}on(t,n){return this._manipulators.on(t,i=>{n(i)})}forEach(t){for(const n of this._manipulators.items)t(n)}some(t){return this._manipulators.items.some(t)}toArray(){const t=[];return this.forEach(n=>t.push(n.manipulator)),t}intersect(t,n){let i=null,o=Number.MAX_VALUE;return this._manipulators.forEach(({manipulator:a,attached:r})=>{if(!r||!a.interactive)return;const c=a.intersectionDistance(t,n);c!=null&&c<o&&(o=c,i=a)}),i}_updateManipulatorAttachment(t){this._isManipulatorItemVisible(t)?this._attachManipulator(t):this._detachManipulator(t)}_attachManipulator(t){t.attached||(t.manipulator.attach&&t.manipulator.attach(this._resourceContexts),t.attached=!0)}_detachManipulator(t){if(!t.attached)return;const n=t.manipulator;n.grabbing=!1,n.dragging=!1,n.hovering=!1,n.selected=!1,n.detach&&n.detach(this._resourceContexts),t.attached=!1}_isManipulatorItemVisible(t){return t.visibilityPredicate===Z.Always||(this._isToolEditable?t.visibilityPredicate===Z.WhenToolEditable:t.visibilityPredicate===Z.WhenToolNotEditable)}}let T=class extends ft{constructor(t){super(t),this.manipulators=new di,this.automaticManipulatorSelection=!0,this.hasGrabbedManipulators=!1,this.hasHoveredManipulators=!1,this.firstGrabbedManipulator=null,this.created=!1,this.removeIncompleteOnCancel=!0,this._editableFlags=new Map([[F.MANAGER,!0],[F.USER,!0]]),this._creationFinishedResolver=en()}get active(){return this.view!=null&&this.view.activeTool===this}set visible(t){this._get("visible")!==t&&(this._set("visible",t),this._syncVisible())}get editable(){return this.getEditableFlag(F.USER)}set editable(t){this.setEditableFlag(F.USER,t)}get updating(){return!1}get cursor(){return null}get hasFocusedManipulators(){return this.hasGrabbedManipulators||this.hasHoveredManipulators}destroy(){this.manipulators.destroy(),this._set("view",null)}onAdd(){this._syncVisible()}activate(){this.view!=null?(this.view.focus(),this.onActivate()):nn.getLogger(this).error("Can't activate tool if view is not defined.")}deactivate(){this.onDeactivate()}handleInputEvent(t){this.onInputEvent(t)}handleInputEventAfter(t){this.onInputEventAfter(t)}setEditableFlag(t,n){this._editableFlags.set(t,n),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),t===F.USER&&this.notifyChange("editable"),this.onEditableChange(),this.onManipulatorSelectionChanged()}getEditableFlag(t){return this._editableFlags.get(t)??!1}whenCreated(){return this._creationFinishedResolver.promise}onManipulatorSelectionChanged(){}onActivate(){}onDeactivate(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(t){}onInputEventAfter(t){}get internallyEditable(){return this.getEditableFlag(F.USER)&&this.getEditableFlag(F.MANAGER)}finishToolCreation(){this.created||this._creationFinishedResolver.resolve(this),this._set("created",!0)}_syncVisible(){if(this.initialized){if(this.visible)this._show();else if(this._hide(),this.active)return void(this.view.activeTool=null)}}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.visible?this.manipulators.attach():this.manipulators.detach()}};s([l({constructOnly:!0})],T.prototype,"view",void 0),s([l({readOnly:!0})],T.prototype,"active",null),s([l({value:!0})],T.prototype,"visible",null),s([l({value:!0})],T.prototype,"editable",null),s([l({readOnly:!0})],T.prototype,"manipulators",void 0),s([l({readOnly:!0})],T.prototype,"updating",null),s([l()],T.prototype,"cursor",null),s([l({readOnly:!0})],T.prototype,"automaticManipulatorSelection",void 0),s([l()],T.prototype,"hasFocusedManipulators",null),s([l()],T.prototype,"hasGrabbedManipulators",void 0),s([l()],T.prototype,"hasHoveredManipulators",void 0),s([l()],T.prototype,"firstGrabbedManipulator",void 0),s([l({readOnly:!0})],T.prototype,"created",void 0),s([l({readOnly:!0})],T.prototype,"removeIncompleteOnCancel",void 0),T=s([M("esri.views.interactive.InteractiveToolBase")],T);function gi(e){return{operations:e,value:e.create()}}function yi(e,t,n=gi(e)){return n.operations=e,e.copy(t,n.value),n}function mi(e){return yi(rn,on(0,0,0,an(e).radius))}function fi(e,t,n,i){return e.operations.axisAt(e.value,t,n,i)}function vi(e,t,n){if(t==null||n==null)return null;const i=new k({spatialReference:n});return sn(e,t,0,st,n,0,1)?(i.x=st[0],i.y=st[1],i.z=st[2],i):null}const st=b(),_i=(()=>{const e=b(),t=b(),n=b();return(i,o)=>{if(Vt(t,i.x,i.y,i.z??0),Vt(n,o.x,o.y,o.z??0),ln(t,n))return null;if(!oe(t,i.spatialReference,t)||!oe(n,o.spatialReference,n)){de(e,n,t),e[2]=0,ge(e,e);let r=pn(cn,e);return e[0]<0&&(r=2*Math.PI-r),gt(r,"radians","geographic")}const{azimuth:a}=un(wi,t,n);return a!=null?gt(a,"degrees","geographic"):void 0}})(),xi=(()=>{const e=b(),t=b();return({x:n,y:i,z:o,spatialReference:a},r,c)=>{const p=o??0;Vt(e,n,i,p);const u=zt(ct(c.value,c.unit,"degrees"),c.rotationType,"geographic");if(!Gt(e,a,e,jt.WGS84)){const d=zt(u,"geographic","arithmetic"),g=ct(d,"degrees","radians");return new k({x:n+r*Math.cos(g),y:i+r*Math.sin(g),z:p,spatialReference:a})}return dn(t,e,u,r),t[2]=p,vi(t,jt.WGS84,a)}})(),wi=new hn;function bi(e,t,n,i){if(!t)return;const{spatialReference:o}=e;if(!Yt(o))return;const a=Me(o),r=Yt(a);if(!r)return;const c=ut(e,n,i),p=Mi;if(!Gt(c,o,p,a))return;const u=Se(t,r);if((n==null?void 0:n.type)==="3d"&&n.viewingMode==="local")p[0]+=u;else{const g=mi(a),h=fi(g,p,lt.X,Oi);gn(p,p,h,u)}if(!Gt(p,a,p,o))return;const d=yn(c,p);return new mn(c,d)}function Ti(e,t,n,i){if(!t)return;const o=ut(e,n,i),a=xi(e,1,t);if(!a)return;const r=ut(a,n,i);return new fn(o,r)}function Si(e,t,n,i){if(e==null)return;const o=Me(t),a=vn(o);return a?new _n(Se(e,a)):void 0}function $i(e){let t;for(const n of e)n&&(t=(t==null?void 0:t.intersect(n))??n);return t}const Mi=b(),Oi=b();let w=class extends ft{constructor(t){super(t),this.committed=null,this.disabled=!1,this.hidden=!1,this.id=xn(),this.inputValue=null,this.readOnly=!1}get dirty(){return this.inputValue!=null}get locked(){return this.committed!=null}lock(t){this.inputValue=null,this.committed=t??this.actual}unlock(){this.committed=null,this.inputValue=null}};s([l()],w.prototype,"actual",void 0),s([l()],w.prototype,"committed",void 0),s([l()],w.prototype,"createQuantity",void 0),s([l()],w.prototype,"disabled",void 0),s([l()],w.prototype,"hidden",void 0),s([l()],w.prototype,"format",void 0),s([l()],w.prototype,"id",void 0),s([l()],w.prototype,"inputValue",void 0),s([l()],w.prototype,"readOnly",void 0),s([l()],w.prototype,"suffix",void 0),s([l()],w.prototype,"title",void 0),s([l()],w.prototype,"toInputUnits",void 0),s([l()],w.prototype,"dirty",null),s([l()],w.prototype,"locked",null),w=s([M("esri.views.interactive.tooltip.fields.TooltipField")],w);let pt=class extends w{constructor(t){super(t),this.mode="absolute-height"}normalizeCtorArgs(t){const n=i=>i.inputUnitInfos.verticalLength.unit;return{actual:P,createQuantity:(i,o)=>yt(i,n(o)),toInputUnits:(i,o)=>Wt(i,n(o)),format:(i,o)=>o.formatters.verticalLength(i),suffix:i=>i.inputUnitInfos.verticalLength.abbreviation,title:i=>i.messages.sketch.elevation,...t}}};s([l()],pt.prototype,"mode",void 0),pt=s([M("esri.views.interactive.tooltip.fields.TooltipFieldElevation")],pt);const Ee=e=>{const t=n=>n.inputUnitInfos.orientation.unit;return new w({actual:$e,createQuantity:(n,i)=>gt(n,t(i),"geographic"),toInputUnits:({value:n,unit:i,rotationType:o},a)=>{const p=zt(ct(n,i,"degrees"),o,"geographic"),u=wn.normalize(p,0,!0),d=t(a),g=ct(u,"degrees",d);return gt(g,d,"geographic")},format:(n,i)=>i.formatters.angle(n),suffix:n=>n.inputUnitInfos.orientation.abbreviation,title:n=>n.messages.sketch.orientation,...e})},Ft=e=>{const t=n=>n.inputUnitInfos.length.unit;return new w({actual:P,createQuantity:(n,i)=>yt(n,t(i)),toInputUnits:(n,i)=>Wt(n,t(i)),format:(n,i)=>i.formatters.length(n),suffix:n=>n.inputUnitInfos.length.abbreviation,title:n=>n.messages.sketch.distance,...e})},Tt=e=>new pt(e),Pi=e=>{const t=n=>n.inputUnitInfos.area.unit;return new w({actual:Y,createQuantity:(n,i)=>Hn(n,t(i)),toInputUnits:(n,i)=>Wt(n,t(i)),format:(n,i)=>i.formatters.area(n),suffix:n=>n.inputUnitInfos.area.abbreviation,title:n=>n.messages.sketch.area,...e})};let H=class extends Q{constructor(t){super(t),this.type="draw-point",this.elevation=Tt()}get allFields(){return[this.elevation]}};s([l()],H.prototype,"type",void 0),s([l()],H.prototype,"elevation",void 0),s([l()],H.prototype,"allFields",null),s([l()],H.prototype,"helpMessage",void 0),H=s([M("esri.views.interactive.tooltip.DrawPointTooltipInfo")],H);let E=class extends Q{constructor(t){super(t),this.type="draw-polyline",this.orientation=Ee(),this.distance=Ft({title:n=>n.messages.sketch.distance}),this.elevation=Tt(),this.totalLength=Ft({format:(n,i)=>i.formatters.totalLength(n),title:n=>n.messages.sketch.totalLength,readOnly:!0})}get allFields(){return[this.orientation,this.distance,this.elevation,this.totalLength]}};s([l()],E.prototype,"type",void 0),s([l()],E.prototype,"orientation",void 0),s([l()],E.prototype,"distance",void 0),s([l()],E.prototype,"elevation",void 0),s([l()],E.prototype,"totalLength",void 0),s([l()],E.prototype,"allFields",null),s([l()],E.prototype,"helpMessage",void 0),E=s([M("esri.views.interactive.tooltip.DrawPolylineTooltipInfo")],E);let C=class extends Q{constructor(t){super(t),this.type="draw-polygon",this.orientation=Ee(),this.distance=Ft({title:n=>n.messages.sketch.distance}),this.elevation=Tt(),this.area=Pi({readOnly:!0})}get allFields(){return[this.orientation,this.distance,this.elevation,this.area]}};s([l()],C.prototype,"type",void 0),s([l()],C.prototype,"distance",void 0),s([l()],C.prototype,"elevation",void 0),s([l()],C.prototype,"area",void 0),s([l()],C.prototype,"allFields",null),s([l()],C.prototype,"helpMessage",void 0),C=s([M("esri.views.interactive.tooltip.DrawPolygonTooltipInfo")],C);let A=class extends Q{constructor(t){super(t),this.type="draw-mesh",this.elevation=Tt()}get allFields(){return[this.elevation]}};s([l()],A.prototype,"type",void 0),s([l()],A.prototype,"elevation",void 0),s([l()],A.prototype,"allFields",null),s([l()],A.prototype,"helpMessage",void 0),A=s([M("esri.views.interactive.tooltip.DrawMeshTooltipInfo")],A);let G=class extends Q{constructor(t){super(t),this.type="draw-rectangle",this.xSize=P,this.ySize=P,this.area=Y}get allFields(){return[]}};s([l()],G.prototype,"type",void 0),s([l()],G.prototype,"xSize",void 0),s([l()],G.prototype,"ySize",void 0),s([l()],G.prototype,"area",void 0),s([l()],G.prototype,"allFields",null),G=s([M("esri.views.interactive.tooltip.DrawRectangleTooltipInfo")],G);let R=class extends Q{constructor(e){super(e),this.type="draw-circle",this.radius=null,this.xSize=null,this.ySize=null,this.area=Y}get allFields(){return[]}};s([l()],R.prototype,"type",void 0),s([l()],R.prototype,"radius",void 0),s([l()],R.prototype,"xSize",void 0),s([l()],R.prototype,"ySize",void 0),s([l()],R.prototype,"area",void 0),s([l()],R.prototype,"allFields",null),R=s([M("esri.views.interactive.tooltip.DrawCircleTooltipInfo")],R);class Ii{constructor(){this.regularVertices=null,this.activeVertex=null,this.full=null,this.outline=null,this.circle=null,this.rectangle=null}}let y=class extends Ut.EventedMixin(T){constructor(e){super(e),this._graphic=null,this._createOperationGeometry=null,this.defaultZ=0,this.geometryType=null,this.hasZ=!0,this.labelOptions=new vt,this.geometryToPlace=null,this.mode=null,this.snappingManager=null,this.snapToScene=!1,this.tooltip=null,this.tooltipOptions=new _t,this._getPointConstraint=et(t=>t),this._getPolylineOrPolygonConstraint=et((t,n,i)=>$i([t,n,i])),this._getDistanceConstraint=et(bi),this._getOrientationConstraint=et(Ti),this._getElevationConstraint=et(Si)}initialize(){this.internalGraphicsLayer=new bn({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer),this.drawOperation=this.makeDrawOperation();const e=this.tooltipOptions,t=this.view.type;this.tooltipInfos={point:new H({tooltipOptions:e,viewType:t}),polyline:new E({tooltipOptions:e,viewType:t}),polygon:new C({tooltipOptions:e,viewType:t}),mesh:new A({tooltipOptions:e,viewType:t}),rectangle:new G({tooltipOptions:e}),circle:new R({tooltipOptions:e})},this.addHandles([this.drawOperation.on("vertex-add",n=>this.onVertexAdd(n)),this.drawOperation.on("vertex-remove",n=>this.onVertexRemove(n)),this.drawOperation.on("vertex-update",n=>this.onVertexUpdate(n)),this.drawOperation.on("cursor-update",n=>this.onCursorUpdate(n)),this.drawOperation.on("complete",n=>this.onComplete(n)),W(()=>this.cursor,n=>{this.drawOperation.cursor=n},ht),W(()=>this.tooltipOptions.enabled,n=>{this.tooltip=n?new Xn({view:this.view,info:this._tooltipInfo}):D(this.tooltip)},ht),Tn(()=>this._updateTooltipInfo())]),this.finishToolCreation()}destroy(){this.drawOperation=D(this.drawOperation),this.tooltip=D(this.tooltip),this._destroyAllVisualisations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=D(this.internalGraphicsLayer),this._set("view",null)}get _defaultElevation(){return yt(this.defaultZ,"meters")}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(e){this._set("centered",e),this._updateGraphic()}get cursor(){return this._get("cursor")}set cursor(e){this._set("cursor",e)}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}set forceUniformSize(e){this._set("forceUniformSize",e),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(e){this._set("graphicSymbol",e),this._graphic!=null&&(this._graphic.symbol=e)}get updating(){var e;return((e=this.drawOperation)==null?void 0:e.updating)??!1}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(e){const t=this._tooltipInfo;if(e.type==="key-down"&&e.key===Sn.enterInputMode&&t!=null&&t.editableFields.length>0&&this.tooltipOptions.inputEnabled)return t.enterInputMode(),void e.stopPropagation();this.drawOperation.onInputEvent(e)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo()}_destroyAllVisualisations(){this.removeHandles(V.outline),this.removeHandles(V.regularVertices),this.removeHandles(V.activeVertex),this.removeHandles(Pt)}_createOrUpdateGraphic(e){if(this._graphic!=null)return this.updateGraphicGeometry(this._graphic,e),this._graphic;const t=this._graphic=new $n({...this.graphicProperties,symbol:this.graphicSymbol});return this.updateGraphicGeometry(t,e),this.internalGraphicsLayer.add(t),this.addHandles(this.initializeGraphic(t)),this.notifyChange("graphic"),this.addHandles(Qt(()=>{this.internalGraphicsLayer.remove(t),D(t),this._graphic===t&&(this._graphic=null)}),Pt),t}updateGraphicGeometry(e,t){e.geometry=t}_getCreateOperationGeometry(e={operationComplete:!1}){var x;const{drawOperation:t}=this;if(t==null||t.numVertices===0)return null;const{coordinateHelper:n,view:i}=t,o=t.stagedVertex,a=t.committedVertices,r=a.slice(),c=o!=null;c&&r.push(n.pointToArray(o));const p=c?n.pointToArray(o):a.splice(-1)[0],u=r.length,d=i.spatialReference,g=i.type==="3d"&&i.viewingMode==="global",h=new Ii;switch(this.geometryType){case"point":case"mesh":h.regularVertices=a,h.activeVertex=p,h.full=n.arrayToPoint(r[0]);break;case"multipoint":h.regularVertices=a,h.activeVertex=p,u>0&&(h.full=si(r,d));break;case"polyline":h.regularVertices=a,h.activeVertex=p,u>0&&(h.full=se([r],d,g));break;case"polygon":h.regularVertices=a,h.activeVertex=p,u>0&&(h.full=N([r],d,g,!0));break;case"circle":if(u>0){const v=re(i,r[0]);if(u===1&&e.operationComplete){const m=r[0],S=v.makeMapPoint(m[0]+ce*i.resolution,m[1]);h.circle=pe([m,S],v,!0),h.full=h.circle!=null?h.circle.geometry:null}else u===2&&(this.forceUniformSize?(h.circle=pe(r,v,this.centered),h.full=h.circle!=null?h.circle.geometry:null):(h.rectangle=pi(r,v,this.centered),h.full=h.rectangle.geometry))}break;case"rectangle":if(u>0){const v=re(i,r[0]);if(u===1&&e.operationComplete){const m=r[0],S=v.makeMapPoint(m[0]+ce*i.resolution,m[1]);h.rectangle=le([m,S],v,!0),h.full=h.rectangle.geometry}else u===2&&(h.rectangle=this.forceUniformSize?le(r,v,this.centered):li(r,v,this.centered),h.full=h.rectangle.geometry)}break;default:return null}switch(this.geometryType){case"point":case"multipoint":break;case"polyline":h.outline=u>1?se([r],d,g):null;break;case"polygon":h.outline=u>1?N([r],d,g):null;break;case"circle":case"rectangle":h.outline=((x=h.full)==null?void 0:x.type)==="polygon"?N(h.full.rings,d,g):null}return h}initializeGraphic(e){return Qt()}onComplete(e){this._updateGraphic();let t=null;if(this.drawOperation.isCompleted){const n=this._getCreateOperationGeometry({operationComplete:!0});n!=null&&(t=this._createOrUpdateGraphic(n.full).clone())}this._createOperationGeometry=null,this.emit("complete",{graphic:t,...e})}onCursorUpdate(e){this._updateGraphic(),this.emit("cursor-update",e)}onDeactivate(){this.drawOperation.isCompleted||this.drawOperation.cancel()}onVertexAdd(e){this._updateGraphic(),this._clearConstraints(),this.emit("vertex-add",e)}onVertexRemove(e){this._updateGraphic(),this._clearConstraints(),this.emit("vertex-remove",e)}onVertexUpdate(e){this._updateGraphic(),this.emit("vertex-update",e)}_updateGraphic(){const e=this._getCreateOperationGeometry();this._createOperationGeometry=e,e!=null?(e.outline!=null?this.addHandles(this.onOutlineChanged(e.outline),V.outline):this.removeHandles(V.outline),e.regularVertices!=null?this.addHandles(this.onRegularVerticesChanged(e.regularVertices),V.regularVertices):this.removeHandles(V.regularVertices),e.activeVertex!=null?this.addHandles(this.onActiveVertexChanged(e.activeVertex),V.activeVertex):this.removeHandles(V.activeVertex),e.full!=null?this._createOrUpdateGraphic(e.full):this.removeHandles(Pt)):this._destroyAllVisualisations()}get _tooltipInfo(){var a;const{drawOperation:e,graphic:t,view:n}=this;if(!e)return null;const i=this.tooltipInfos,o=(a=t==null?void 0:t.geometry)==null?void 0:a.type;switch(this.geometryType){case"point":return n.type==="2d"&&this.defaultZ===0?null:o==="point"?i.point:null;case"polyline":return o==="polyline"?i.polyline:null;case"polygon":return o==="polygon"?i.polygon:null;case"rectangle":return o==="polygon"?i.rectangle:null;case"circle":return o==="polygon"?i.circle:null;case"mesh":return o==="mesh"?i.mesh:null;default:return null}}_updateTooltipInfo(){const{_tooltipInfo:e,tooltip:t}=this;if(e&&t){switch(e.type){case"draw-point":this._updateDrawPointTooltipInfo(e);break;case"draw-polyline":this._updateDrawPolylineTooltipInfo(e);break;case"draw-polygon":this._updateDrawPolygonTooltipInfo(e);break;case"draw-rectangle":this._updateDrawRectangleTooltipInfo(e);break;case"draw-circle":this._updateDrawCircleTooltipInfo(e);break;case"draw-mesh":this.updateDrawMeshTooltipInfo(e)}t.info=e}}_updateDrawPointTooltipInfo(e){const{drawOperation:t,graphic:n,view:i,tooltipOptions:o}=this,{elevationInfo:a,stagedVertex:r}=t;if(e.tooltipOptions=o,e.viewType=i.type,e.helpMessage=Ot("point",n==null?void 0:n.geometry),this.updateElevation(e.elevation),!r)return void(t.constraint=void 0);const c=t.coordinateHelper.spatialReference;t.constraint=this._getPointConstraint(this._getElevationConstraint(e.elevation.committed,c,i,a))}_updateDrawPolylineTooltipInfo(e){const t=this._createOperationGeometry,n=t!=null?t.full:null;if((n==null?void 0:n.type)!=="polyline")return;const{drawOperation:i,tooltipOptions:o,view:a}=this,{lastVertex:r,stagedVertex:c}=i;this._updatePolylineOrPolygonCommon(e,c);const p=Nn(n,this._elevationMode);e.totalLength.actual=p??P,e.totalLength.hidden=length==null||!r,e.tooltipOptions=o,e.viewType=a.type,e.helpMessage=Ot("polyline",n),this.updateElevation(e.elevation)}_updateDrawPolygonTooltipInfo(e){const t=this._createOperationGeometry,n=t!=null?t.full:null;if((n==null?void 0:n.type)!=="polygon")return;const{drawOperation:i,tooltipOptions:o,view:a}=this,{lastVertex:r}=i;let c=i.stagedVertex;(n==null?void 0:n.type)==="polygon"&&r&&!c&&(c=n.getPoint(0,n.rings[0].length-1)),this._updatePolylineOrPolygonCommon(e,c);const p=ae(n,this._elevationMode);e.area.actual=p??Y,e.area.hidden=p==null&&!r,e.tooltipOptions=o,e.viewType=a.type,e.helpMessage=Ot("polygon",n),this.updateElevation(e.elevation)}_updatePolylineOrPolygonCommon(e,t){const{view:n,drawOperation:i}=this,{elevationInfo:o,lastVertex:a}=i;if(!a||!t)return e.distance.hidden=!0,e.orientation.hidden=!0,void(i.constraint=void 0);const r=qn(a,t,this._elevationMode);e.distance.actual=r??P,e.distance.hidden=!1;const c=_i(a,t);e.orientation.actual=c??$e,e.orientation.hidden=!1;const p=i.coordinateHelper.spatialReference;i.constraint=this._getPolylineOrPolygonConstraint(this._getDistanceConstraint(a,e.distance.committed,n,o),this._getOrientationConstraint(a,e.orientation.committed,n,o),this._getElevationConstraint(e.elevation.committed,p,n,o))}updateDrawMeshTooltipInfo(e){}_updateDrawRectangleTooltipInfo(e){e.tooltipOptions=this.tooltipOptions,e.xSize=this._xSize??P,e.ySize=this._ySize??P,e.area=this._fullGeometryArea??Y}_updateDrawCircleTooltipInfo(e){const{forceUniformSize:t}=this;e.tooltipOptions=this.tooltipOptions,e.radius=t?this._circleRadius??P:null,e.xSize=t?null:this._xSize??P,e.ySize=t?null:this._ySize??P,e.area=this._fullGeometryArea??Y}get _circleRadius(){var t;const e=this._createOperationGeometry;return((t=e==null?void 0:e.circle)==null?void 0:t.center)!=null&&e.circle.edge!=null?Mt(e.circle.center,e.circle.edge,this._elevationMode):null}get _xSize(){var t,n;const e=(n=(t=this._createOperationGeometry)==null?void 0:t.rectangle)==null?void 0:n.midpoints;return e!=null?Mt(e.left,e.right,this._elevationMode):null}get _ySize(){var t,n;const e=(n=(t=this._createOperationGeometry)==null?void 0:t.rectangle)==null?void 0:n.midpoints;return e!=null?Mt(e.top,e.bottom,this._elevationMode):null}get _fullGeometryArea(){var t;const e=(t=this._createOperationGeometry)==null?void 0:t.full;return(e==null?void 0:e.type)!=="polygon"?null:ae(e,this._elevationMode)}updateElevation(e){e.actual=this._vertexTooltipElevation}get _vertexTooltipElevation(){const{tooltipOptions:e,view:t,drawOperation:n}=this;if(n==null)return this._defaultElevation;const i=n.stagedVertex??n.lastVertex;if(i==null||t.type==="2d")return this._defaultElevation;const o={mode:e.elevation.mode,offset:0},a=(Zt(t,i,n.elevationInfo,o)??0)*Mn(i.spatialReference);return yt(a,"meters")}get _elevationMode(){return this.drawOperation.isDraped?"on-the-ground":"absolute-height"}_clearConstraints(){for(const[,e]of Object.entries(this.tooltipInfos))e.unlockAllFields()}};s([l()],y.prototype,"_createOperationGeometry",void 0),s([l()],y.prototype,"_defaultElevation",null),s([l({value:!0})],y.prototype,"centered",null),s([l()],y.prototype,"cursor",null),s([l({nonNullable:!0})],y.prototype,"defaultZ",void 0),s([l()],y.prototype,"drawOperation",void 0),s([l({value:!0})],y.prototype,"enabled",null),s([l({value:!0})],y.prototype,"forceUniformSize",null),s([l({constructOnly:!0})],y.prototype,"geometryType",void 0),s([l()],y.prototype,"graphic",null),s([l({constructOnly:!0})],y.prototype,"graphicProperties",void 0),s([l()],y.prototype,"graphicSymbol",null),s([l({constructOnly:!0})],y.prototype,"hasZ",void 0),s([l({constructOnly:!0,type:vt})],y.prototype,"labelOptions",void 0),s([l({constructOnly:!0})],y.prototype,"geometryToPlace",void 0),s([l({constructOnly:!0})],y.prototype,"mode",void 0),s([l()],y.prototype,"snappingManager",void 0),s([l()],y.prototype,"snapToScene",void 0),s([l()],y.prototype,"tooltip",void 0),s([l()],y.prototype,"tooltipInfos",void 0),s([l({constructOnly:!0,type:_t})],y.prototype,"tooltipOptions",void 0),s([l({readOnly:!0})],y.prototype,"type",void 0),s([l({readOnly:!0})],y.prototype,"updating",null),s([l({constructOnly:!0,nonNullable:!0})],y.prototype,"view",void 0),s([l()],y.prototype,"_tooltipInfo",null),s([l()],y.prototype,"_circleRadius",null),s([l()],y.prototype,"_xSize",null),s([l()],y.prototype,"_ySize",null),s([l()],y.prototype,"_fullGeometryArea",null),s([l()],y.prototype,"_vertexTooltipElevation",null),s([l()],y.prototype,"_elevationMode",null),y=s([M("esri.views.draw.DrawGraphicTool")],y);const Pt="create-operation-graphic",V={outline:"outline-visual",regularVertices:"regular-vertices-visual",activeVertex:"active-vertex-visual"};function So(e){switch(e){case"point":case"polyline":case"polygon":case"multipoint":return e;case"circle":case"rectangle":return"segment";case"mesh":return"point"}}const ce=48,Ve="click";class Ei{constructor({grabbableForEvent:t}){this.events=new Ut,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0,this.consumesClicks=!0,this.grabbableForEvent=t}destroy(){}intersectionDistance(t,n){return 0}attach(){}detach(){}onElevationChange(){}onViewChange(){}}function Vi(e,t){let n=null,i=null;return o=>{if(o.action==="cancel")return void(i!=null&&(i.execute({action:"cancel"}),n=null,i=null));const a={action:o.action,screenStart:o.start,screenEnd:o.screenPoint};o.action==="start"&&n==null&&(n=new nt,i=new nt,t(e,n,i,o.pointerType,a)),n!=null&&n.execute(a),o.action==="end"&&n!=null&&(n=null,i=null)}}function It(e,t){return e.events.on("drag",Vi(e,t))}function $o(e,t){const n=[e.x,e.y,e.z??0],i=t,o=[Math.cos(i),Math.sin(i)],a=Math.sqrt(o[0]*o[0]+o[1]*o[1]);if(a===0)return null;o[0]/=a,o[1]/=a;const r=c=>{const p=(c.x-n[0])*o[0]+(c.y-n[1])*o[1];c.x=n[0]+p*o[0],c.y=n[1]+p*o[1]};return c=>(r(c.mapStart),r(c.mapEnd),{...c,axis:o})}function Ci(e,t){let n=null;return i=>{if(i.action==="start"&&(n=Ri(e,i.mapStart.spatialReference,t)),n==null)return null;const o=i.mapEnd.x-i.mapStart.x,a=i.mapEnd.y-i.mapStart.y,r=i.mapEnd.z-i.mapStart.z;return n.move(o,a,r,i.action),{...i,translationX:o,translationY:a,translationZ:r}}}function Ce(e,t){return e==null?null:e.spatialReference.equals(t)?e.clone():xt(e,t)}function Ri(e,t,n){const i=e.geometry,o=ii(t);if(i==null)return null;if(i.type==="mesh")return zi(e,i,o,n);const a=Ce(i,o),r=i.spatialReference;return a==null?null:{move:(c,p,u)=>{const d=Oe(a.clone(),c,p,u);d.spatialReference.equals(r)?e.geometry=d:e.geometry=xt(d,r)}}}function zi(e,t,n,i){if(t.vertexSpace.isRelative)return Gi(e,t,t.vertexSpace,n);if(!t.spatialReference.equals(n))return null;let o=0,a=0,r=0;return{move:(c,p,u)=>{const d=c-o,g=p-a,h=u-r;if(d||g||h){const x=new k(t.origin.x+d,t.origin.y+g,(t.origin.z??0)+h,t.origin.spatialReference);t.centerAt(x,{geographic:t.vertexSpace.isRelative?void 0:i===fe.Global}),e.notifyGeometryChanged(),o=c,a=p,r=u}}}}function Gi(e,t,n,i){const o=Ce(n.getOriginPoint(t.spatialReference),i),a=t.spatialReference;return o==null?null:{move:(r,c,p,u)=>{const d=Oe(o.clone(),r,c,p);if(d.spatialReference.equals(a))n.setOriginFromPoint(d);else{const g=xt(d,a);g!=null&&n.setOriginFromPoint(g)}if(n.isGeoreferenced)e.notifyGeometryChanged();else{const g=u==="end";e.notifyMeshTransformChanged(g?{action:oi.UpdateFastLocalOrigin}:{})}}}}function Mo(e,t=null,n){var r;let i=null;const o=t==null||(r=e.spatialReference)!=null&&r.equals(t)?c=>c:c=>c!=null?xt(c,t):c,a={exclude:[],...n};return c=>{if(c.action==="start"&&(i=o(e.toMap(c.screenStart,a))),i==null)return null;const p=o(e.toMap(c.screenEnd,a));return p!=null?{...c,mapStart:i,mapEnd:p}:null}}function Oo(e,t){const n=e.map(i=>Ci(i,t)).filter(it);return i=>{const o=i.mapEnd.x-i.mapStart.x,a=i.mapEnd.y-i.mapStart.y,r=i.mapEnd.z-i.mapStart.z;return n.forEach(c=>c(i)),{...i,translationX:o,translationY:a,translationZ:r}}}function Di(e,t){const n=new Map;for(const i of t)n.set(i,At(e[i]));return i=>(n.forEach((o,a)=>{e[a]=o}),i)}function ki(e){return e.geometry!=null&&e.geometry.type==="mesh"?Fi(e,e.geometry):Di(e,["geometry"])}function Fi(e,t){var a;const{vertexSpace:n}=t;if(n.isGeoreferenced){const r=t.vertexAttributes.clonePositional();return c=>(t.vertexAttributes=r,e.notifyGeometryChanged(),c)}const i=On(n.origin),o=(a=t.transform)==null?void 0:a.clone();return r=>(t.transform=o,t.vertexSpace.origin=i,e.notifyMeshTransformChanged(),r)}function Po(e){const t=e.map(n=>ki(n)).filter(n=>n!=null);return n=>(t.forEach(i=>i(n)),n)}function Io(){let e=0,t=0,n=0;return i=>{i.action==="start"&&(e=i.mapStart.x,t=i.mapStart.y,n=i.mapStart.z);const o=i.mapEnd.x-e,a=i.mapEnd.y-t,r=i.mapEnd.z-n;return e=i.mapEnd.x,t=i.mapEnd.y,n=i.mapEnd.z,{...i,mapDeltaX:o,mapDeltaY:a,mapDeltaZ:r,mapDeltaSpatialReference:i.mapStart.spatialReference}}}function Eo(){let e=0,t=0;return n=>{n.action==="start"&&(e=n.screenStart.x,t=n.screenStart.y);const i=n.screenEnd.x-e,o=n.screenEnd.y-t;return e=n.screenEnd.x,t=n.screenEnd.y,{...n,screenDeltaX:i,screenDeltaY:o}}}function Vo(e,t){let n=null,i=0,o=0;return a=>{var u;if(a.action==="start"&&(n=(u=e.toScreen)==null?void 0:u.call(e,t),n!=null&&(n.x<0||n.x>e.width||n.y<0||n.y>e.height?n=null:(i=a.screenStart.x-n.x,o=a.screenStart.y-n.y))),n==null)return null;const r=Bt(a.screenEnd.x-i,0,e.width),c=Bt(a.screenEnd.y-o,0,e.height),p=ve(r,c);return a.screenStart=n,a.screenEnd=p,a}}const Hi=()=>{};class nt{constructor(){this.execute=Hi}next(t,n=new nt){return t!=null&&(this.execute=i=>{const o=t(i);o!=null&&n.execute(o)}),n}}function Ai(e,t,n=[]){if(e.type==="2d")return o=>o;let i=null;return o=>{o.action==="start"&&(i=e.toMap(o.screenStart,{exclude:n}),i!=null&&(i.z=dt(i,e,t)));const a=e.toMap(o.screenEnd,{exclude:n});a!=null&&(a.z=dt(a,e,t));const r=i!=null&&a!=null?{sceneStart:i,sceneEnd:a}:null;return{...o,scenePoints:r}}}function ue(e,t,n){const i=t.elevationProvider.getElevation(e.x,e.y,e.z??0,e.spatialReference,"scene")??0,o=bt(e);return o.z=i,o.hasZ=!0,o.z=dt(o,t,n),o}function Co(e,t){if(e.type==="2d")return i=>i;let n=null;return i=>{i.action==="start"&&(n=ue(i.mapStart,e,t));const o=ue(i.mapEnd,e,t),a=n!=null&&o!=null?{sceneStart:n,sceneEnd:o}:null;return{...i,scenePoints:a}}}function Ui({predicate:e=()=>!0,snappingManager:t,snappingContext:n,updatingHandles:i,useZ:o=!0}){const a=new nt;if(t==null)return{snappingStep:[he,a],cancelSnapping:he};let r,c=null,p=null,u=null;const d=()=>{c=Ct(c),t.doneSnapping(),p==null||p.frameTask.remove(),p=null,r=we(r),u=null},g=Zi(t,o,a);let h=null,x=null,v=null;return{snappingStep:[m=>{if(!e(m))return m;const{action:S}=m;if(S==="start"){const{info:O}=m,$=Wi(t.view);if(p=Li(n,m,$),p.context.selfSnappingZ=null,!o&&O!=null){const z=qi(n.coordinateHelper,O.handle.component);z!=null&&(p.context.selfSnappingZ={value:z,elevationInfo:n.elevationInfo??Pn})}}if(p!=null){const{context:O,originalScenePos:$,originalPos:z}=p,{mapEnd:B,mapStart:J,scenePoints:I}=m,K=Re(z,Ht(B,J)),ot=Ht(J,z),De={...m,action:"update"},ke=p.context,St=Ni($,I),Lt=t.update({point:K,scenePoint:St,context:O});if(v=Lt,ze(B,Lt,ot,o),h=K,x=St,S!=="end"){const{frameTask:Fe}=p;c==null&&(c=new AbortController),u=He=>{i.addPromise(Rt(g({frameTask:Fe,event:De,context:ke,point:K,scenePoint:St,delta:ot,getLastState:()=>({point:h,scenePoint:x,updatePoint:He.forceUpdate?null:v})},c.signal)))},u({forceUpdate:!1}),r==null&&(r=W(()=>t.options.effectiveEnabled,()=>u==null?void 0:u({forceUpdate:!0})))}}return S==="end"&&d(),m},a],cancelSnapping:m=>(d(),m)}}function Zi(e,t,n){return be(async({frameTask:i,point:o,scenePoint:a,context:r,event:c,delta:p,getLastState:u},d)=>{const g=await i.schedule(()=>e.snap({point:o,scenePoint:a,context:r,signal:d}),d);if(g.valid){let h=await i.schedule(()=>g.apply(),d);const x=u();x.point!=null&&o!==x.point&&(h=e.update({point:x.point,scenePoint:x.scenePoint,context:r})),x.updatePoint!=null&&kt(h,x.updatePoint)||(ze(c.mapEnd,h,p,t),n.execute(c))}})}function Wi(e){return e.type==="3d"?e.resourceController.scheduler.registerTask(_e.SNAPPING):xe}function Li(e,t,n){return{context:new Dt({editGeometryOperations:e.editGeometryOperations,elevationInfo:e.elevationInfo,pointer:e.pointer,vertexHandle:t.info!=null?t.info.handle:null,excludeFeature:e.excludeFeature,feature:e.feature,visualizer:e.visualizer}),originalPos:t.snapOrigin!=null?e.coordinateHelper.vectorToDehydratedPoint(t.snapOrigin):t.mapStart,originalScenePos:t.scenePoints!=null?t.scenePoints.sceneStart:null,frameTask:n}}function Re(e,[t,n,i]){const o=bt(e);return o.x+=t,o.y+=n,o.hasZ&&(o.z+=i),o}function Ni(e,t){return e==null||t==null?null:Re(e,Ht(t.sceneEnd,t.sceneStart))}function Ht(e,t){const n=e.hasZ&&t.hasZ?e.z-t.z:0;return[e.x-t.x,e.y-t.y,n]}function ze(e,t,[n,i,o],a){e.x=t.x+n,e.y=t.y+i,a&&e.hasZ&&t.hasZ&&(e.z=t.z+o)}function qi(e,t){if(!e.hasZ())return null;const n=t.vertices;let i=null;for(const o of n){const a=e.getZ(o.pos);if(i!=null&&a!=null&&Math.abs(a-i)>1e-6)return null;i==null&&(i=a)}return i}function he(e){return e}let U=class extends ft{constructor(e){super(e),this.constrainResult=t=>t,this._snapPoints=null,this._frameTask=null,this._abortController=null,this._stagedPoint=null,this._snap=be(async(t,n,i,o)=>{const a=this._frameTask;if(a==null)return;const r=await a.schedule(()=>n.snap({...t,context:i,signal:o}),o);r.valid&&await a.schedule(()=>{this.stagedPoint=r.apply(),t!==this._snapPoints&&this._snapPoints!=null&&(this.stagedPoint=n.update({...this._snapPoints,context:i}))},o)})}get stagedPoint(){return this._stagedPoint}set stagedPoint(e){this._stagedPoint=this.constrainResult(e)}initialize(){var t,n;const e=this.view.type==="3d"?(n=(t=this.view)==null?void 0:t.resourceController)==null?void 0:n.scheduler:null;this._frameTask=e!=null?e.registerTask(_e.SNAPPING):xe}destroy(){this._abortController=Ct(this._abortController),this._frameTask=we(this._frameTask)}update(e,t,n){this._snapPoints=e;const{point:i,scenePoint:o}=e,a=t.update({point:i,scenePoint:o,context:n});return this.stagedPoint=a,a}async snap(e,t,n){const{point:i,scenePoint:o}=e;return this.stagedPoint=t.update({point:i,scenePoint:o,context:n}),this._snapPoints=e,this._abortController==null&&(this._abortController=new AbortController),this._snap(e,t,n,this._abortController.signal)}async resnap(e,t){this._snapPoints!=null&&await this.snap(this._snapPoints,e,t)}abort(){this._abortController=Ct(this._abortController),this._snapPoints=null}};s([l({constructOnly:!0})],U.prototype,"view",void 0),s([l()],U.prototype,"stagedPoint",null),s([l()],U.prototype,"constrainResult",void 0),s([l()],U.prototype,"_stagedPoint",void 0),U=s([M("esri.views.interactive.snapping.SnappingOperation")],U);const Xi="crosshair",ji="progress";let f=class extends Ut.EventedMixin(ft){constructor(t){super(t),this._createOperationCompleted=!1,this._hideDefaultCursor=!1,this._pointerDownStates=new Set,this._stagedScreenPoint=null,this._stagedPointerType=null,this._stagedPointerId=null,this._updatingHandles=new In,this.constraint=void 0,this.isDraped=!0,this.labelOptions=new vt,this.tooltipOptions=new _t,this.cursor=null,this.loading=!1,this.snapToSceneEnabled=null,this.lastVertex=null,t.elevationInfo==null&&(this.elevationInfo=En(!!t.hasZ))}initialize(){const{geometryType:t,view:n}=this,i=n.spatialReference,o="viewingMode"in n.state?n.state.viewingMode:fe.Local,a=t==="segment"||t==="multipoint"?"polyline":t;this.coordinateHelper=jn(this.hasZ,this.hasM,i),this._editGeometryOperations=new Yn(new Qn(a,this.coordinateHelper)),this._snappingOperation=new U({view:n,constrainResult:p=>{var u;return p?(u=this._getEffectiveDrawSurface())==null?void 0:u.constrainZ(p):void 0}}),this.addHandles([W(()=>this.stagedVertex,p=>{p!=null&&this.emit("cursor-update",{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activeComponent.vertices.length,coordinates:this.coordinateHelper.pointToArray(p)}],operation:"apply",type:"vertex-update"})},{sync:!0,equals:(p,u)=>Rn(p,u,kt)}),W(()=>this.view.viewpoint,(p,u)=>{p&&u&&ni(p,u)&&this._onViewpointChange()})]),this._activeComponent=new Bn(i,o),this._editGeometryOperations.data.components.push(this._activeComponent);const r=this.segmentLabels;r!=null&&(r.context={view:n,editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,labelOptions:this.labelOptions},this.addHandles([W(()=>this.labelOptions.enabled,p=>{r.visible=p},ht),this.on("cursor-update",()=>{const p=this.stagedVertex;r.stagedVertex=p!=null?this.coordinateHelper.pointToVector(p):null})])),this.addHandles(this._editGeometryOperations.on(["vertex-add","vertex-update","vertex-remove"],p=>{const u=p.vertices.map(x=>({componentIndex:0,vertexIndex:x.index,coordinates:this.coordinateHelper.vectorToArray(x.pos)})),d=u.map(x=>x.coordinates);switch(p.type){case"vertex-add":this.emit(p.type,{...p,added:d,vertices:u});break;case"vertex-update":this.emit(p.type,{...p,updated:d,vertices:u});break;case"vertex-remove":this.emit(p.type,{...p,removed:d,vertices:u})}const g=this._activeComponent.getLastVertex(),h=g!=null?this.coordinateHelper.vectorToDehydratedPoint(g.pos):null;h!=null&&this.lastVertex!=null&&kt(this.lastVertex,h)||(this.lastVertex=h)}));const c=this._manipulator=new Ei({grabbableForEvent:p=>this.drawingMode!=="click"||p.pointerType==="touch"&&this._snappingEnabled&&this._pointerDownStates.size===1});this.manipulators.add(c),c.grabbable=t!=="point",this.addHandles([this._createManipulatorDragPipeline(c),c.events.on("immediate-click",p=>this._onImmediateClick(p)),c.events.on("immediate-double-click",p=>this._onImmediateDoubleClick(p)),W(()=>({effectiveCursor:this.effectiveCursor}),({effectiveCursor:p})=>{c.cursor=p},ht)]),Vn(this,()=>{const p=this.view.inputManager.latestPointerType??"mouse",u=this._getSnappingContext(p);this.snappingManager!=null&&this._updatingHandles.addPromise(Rt(this._snappingOperation.resnap(this.snappingManager,u)))})}destroy(){D(this.segmentLabels),D(this._snappingOperation),this._editGeometryOperations=D(this._editGeometryOperations),this._updatingHandles.destroy()}get _snappingEnabled(){return this.snappingManager!=null&&this.snappingManager.options.effectiveEnabled}get _requiresScenePoint(){const t=this._getEffectiveDrawSurface();return this.view.type==="3d"&&this.drawSurface!==t}get canRedo(){return this._editGeometryOperations.canRedo}get canUndo(){return this._editGeometryOperations.canUndo}get committedVertices(){return this._activeComponent.vertices.map(t=>this.coordinateHelper.vectorToArray(t.pos))}set drawingMode(t){this._set("drawingMode",t??Ve)}get effectiveCursor(){return this.loading?ji:this._hideDefaultCursor?null:this.cursor||Xi}get interactive(){return this._manipulator.interactive}set interactive(t){this._manipulator.interactive=t}get isCompleted(){return this._createOperationCompleted}get numCommittedVertices(){return this._activeComponent.vertices.length}get numVertices(){return this.stagedVertex!=null?this._activeComponent.vertices.length+1:this._activeComponent.vertices.length}get snappingOptions(){return this.snappingManager!=null?this.snappingManager.options:null}get stagedVertex(){const t=this._snappingOperation.stagedPoint,{constraint:n,elevationInfo:i,view:o}=this;if(!t||!n)return t;const a=ut(t,o,i),r=a?n.closestTo(a):void 0;return r?Cn(r,t.spatialReference):t}set stagedVertex(t){this._snappingOperation.stagedPoint=At(t)}get updating(){return this._updatingHandles.updating}get vertices(){const t=this.committedVertices;return this.stagedVertex!=null&&t.push(this.coordinateHelper.pointToArray(this.stagedVertex)),t}cancel(){this.complete({aborted:!0})}commitStagedVertex(){if(this._snappingOperation.abort(),this.stagedVertex!=null){const{stagedVertex:t}=this;this.stagedVertex=null,this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(t))}}complete(t){const n=t&&t.aborted||!1;this._snappingOperation.abort(),this.snappingManager!=null&&this.snappingManager.doneSnapping(),this.geometryType==="segment"||this.geometryType==="point"?this.commitStagedVertex():this.stagedVertex=null;const i=this.geometryType==="multipoint"&&this.numVertices===0||this.geometryType==="polyline"&&this.numVertices<2||this.geometryType==="polygon"&&this.numVertices<3;this._createOperationCompleted=!i,(this.isCompleted||n)&&this.emit("complete",{vertices:this.vertices.map((o,a)=>({componentIndex:0,vertexIndex:a,coordinates:o})),aborted:n,type:"complete"})}onInputEvent(t){switch(t.type){case"pointer-down":this._pointerDownStates.add(t.pointerId);break;case"pointer-up":this._pointerDownStates.delete(t.pointerId)}switch(t.type){case"pointer-move":return this._onPointerMove(t);case"hold":return this._onHold(t)}}redo(){this._editGeometryOperations.redo()}undo(){this.snappingManager!=null&&this.snappingManager.doneSnapping(),this._editGeometryOperations.undo()}_closeOnClickVertexIndex(t){const n=this._activeComponent;if(this.geometryType==="polygon"&&n.vertices.length>2){if(this._vertexWithinPointerDistance(n.vertices[0].pos,t))return 0;if(this._vertexWithinPointerDistance(n.vertices[n.vertices.length-1].pos,t))return n.vertices.length-1}return null}_createManipulatorDragPipeline(t){switch(this.drawingMode){case"click":return this._createManipulatorDragPipelineClick(t);case"freehand":return this._createManipulatorDragPipelineFreehand(t);case"hybrid":return this._createManipulatorDragPipelineHybrid(t)}}_createManipulatorDragPipelineClick(t){return It(t,(n,i,o,a)=>{const r=a==="touch"&&this._snappingEnabled;if(this.isCompleted||!r)return;const{snappingStep:c,cancelSnapping:p}=Ui({predicate:()=>r,snappingManager:this.snappingManager,snappingContext:new Dt({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,feature:this.graphic,pointer:a,visualizer:this.snappingVisualizer}),updatingHandles:this._updatingHandles,useZ:!this._requiresScenePoint});o=o.next(u=>(r&&this.snappingManager!=null&&this.snappingManager.doneSnapping(),u)).next(p),i.next(this._screenToMapDragEventStep()).next(u=>(u.action==="start"&&(this.stagedVertex=u.mapStart,(this.geometryType==="segment"||r&&this.numVertices===0)&&this.commitStagedVertex()),u)).next(Ai(this.view,this.elevationInfo)).next(...c).next(u=>(r&&(this.stagedVertex=u.mapEnd,u.action==="end"&&this.commitStagedVertex()),u)).next(u=>(u.action==="end"&&(this.geometryType!=="segment"&&this.geometryType!=="point"||this.complete()),u))})}_createManipulatorDragPipelineFreehand(t){return It(t,(n,i)=>{this.isCompleted||i.next(this._screenToMapDragEventStep()).next(o=>(o.action==="start"&&(this.stagedVertex==null&&(this.stagedVertex=o.mapStart),this.geometryType==="segment"&&this.commitStagedVertex()),o)).next(o=>{switch(o.action){case"start":case"update":this.stagedVertex=o.mapEnd,this.geometryType!=="polygon"&&this.geometryType!=="polyline"||this.commitStagedVertex();break;case"end":this.complete()}return o})})}_createManipulatorDragPipelineHybrid(t){return It(t,(n,i)=>{this.isCompleted||i.next(this._screenToMapDragEventStep()).next(o=>(o.action==="start"&&(this.stagedVertex==null&&(this.stagedVertex=o.mapStart),this.commitStagedVertex()),o)).next(o=>{switch(o.action){case"start":case"update":this.stagedVertex=o.mapEnd,this.geometryType!=="polygon"&&this.geometryType!=="polyline"||this.commitStagedVertex();break;case"end":this.geometryType!=="segment"&&this.geometryType!=="point"||this.complete()}return o})})}get _drawAtFixedElevation(){return(this.geometryType==="segment"||this.geometryType==="polygon")&&this.numCommittedVertices>0}_getEffectiveDrawSurface(){if(this.elevationDrawSurface==null)return this.drawSurface;if(!this.coordinateHelper.hasZ())return this.elevationDrawSurface.defaultZ=null,this.elevationDrawSurface;let t=this.defaultZ,n=!1;return this.elevationInfo!=null&&this.elevationInfo.mode==="absolute-height"&&(n=!0),this.snapToSceneEnabled!=null&&(n=this.snapToSceneEnabled),this.elevationInfo!=null&&this.elevationInfo.mode==="on-the-ground"&&(n=!1),this._drawAtFixedElevation&&(t=this.coordinateHelper.getZ(this._activeComponent.vertices[0].pos),n=!1),n?this.drawSurface:(this.elevationDrawSurface.defaultZ=t,this.elevationDrawSurface)}_mapToScreen(t){var n;return(n=this._getEffectiveDrawSurface())==null?void 0:n.mapToScreen(t)}_onHold(t){this._snappingOperation.abort(),this.drawingMode==="click"&&t.pointerType==="touch"&&this._snappingEnabled&&(this.stagedVertex=t.mapPoint),t.stopPropagation()}_onImmediateClick(t){if(t.pointerType==="mouse"&&t.button===2||this._manipulator.dragging)return;const n=this._activeComponent;if(this._closeOnClickVertexIndex(t.screenPoint)!=null)return t.stopPropagation(),void this.complete();const i=this._screenToMap(t.screenPoint);if(i!=null)switch(this.drawingMode){case"freehand":this.geometryType==="point"&&(this.stagedVertex!=null?this.commitStagedVertex():this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(i)),this.complete());break;case"click":case"hybrid":this._snappingOperation.abort(),this.stagedVertex!=null?this.commitStagedVertex():this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(i)),(this.geometryType==="point"||this.geometryType==="segment"&&n.vertices.length===2||this.geometryType==="segment"&&this.drawingMode==="hybrid"&&n.vertices.length===1)&&this.complete()}t.stopPropagation()}_onImmediateDoubleClick(t){this._manipulator.dragging||this.geometryType==="point"||(this.complete(),t.stopPropagation())}_onPointerMove(t){const n=ve(t.x,t.y);this._stagedScreenPoint=n,this._stagedPointerType=t.pointerType,this._stagedPointerId=t.pointerId;const i=this._snappingOperation,o=this._manipulator;this._pointerDownStates.has(t.pointerId)||o.grabbing||!o.interactive?i.abort():(t.stopPropagation(),this._updateStagedVertexOnPointerMove(n,t.pointerType))}_onViewpointChange(){const t=this._manipulator;this._stagedPointerType==="mouse"&&this._stagedScreenPoint&&this._stagedPointerId!=null&&!this._pointerDownStates.has(this._stagedPointerId)&&!t.grabbing&&t.interactive?this._updateStagedVertexOnPointerMove(this._stagedScreenPoint,this._stagedPointerType??"mouse"):this._snappingOperation.abort()}_updateStagedVertexOnPointerMove(t,n){var u;const i=this._snappingOperation,o=this._closeOnClickVertexIndex(t);if(o!=null)return this._closeOnVertex(o),void i.abort();const a=this._screenToMap(t),r=this._requiresScenePoint?(u=this.drawSurface)==null?void 0:u.screenToMap(t):null;if(a==null)return this._hideDefaultCursor=!0,void i.abort();this._hideDefaultCursor=!1;const c=this.snappingManager;if(c==null)return this.stagedVertex=a,void i.abort();const p=this._getSnappingContext(n);this._updatingHandles.addPromise(Rt(i.snap({point:a,scenePoint:r},c,p)))}_closeOnVertex(t){this.stagedVertex=null;const n={componentIndex:0,vertexIndex:t,coordinates:this.coordinateHelper.vectorToArray(this._activeComponent.vertices[t].pos)};this.emit("cursor-update",{updated:null,vertices:[n],operation:"apply",type:"vertex-update"})}_screenToMap(t){var n;return(n=this._getEffectiveDrawSurface())==null?void 0:n.screenToMap(t)}_screenToMapDragEventStep(){let t=null;return n=>{if(n.action==="start"&&(t=this._screenToMap(n.screenStart)),t==null)return null;const i=this._screenToMap(n.screenEnd);return i!=null?{...n,mapStart:t,mapEnd:i}:null}}_vertexWithinPointerDistance(t,n){const o=this._mapToScreen(this.coordinateHelper.vectorToDehydratedPoint(t));return o!=null&&Yi(o,n,25)}_getSnappingContext(t){var i;const n=this._drawAtFixedElevation?(i=this.elevationDrawSurface)==null?void 0:i.defaultZ:null;return new Dt({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:t,feature:this.graphic,visualizer:this.snappingVisualizer,selfSnappingZ:n!=null?{value:n,elevationInfo:this.elevationInfo}:null})}};function Yi(e,t,n){const i=e.x-t.x,o=e.y-t.y;return i*i+o*o<=n}s([l()],f.prototype,"_hideDefaultCursor",void 0),s([l()],f.prototype,"_snappingOperation",void 0),s([l()],f.prototype,"_snappingEnabled",null),s([l({constructOnly:!0})],f.prototype,"graphic",void 0),s([l()],f.prototype,"constraint",void 0),s([l()],f.prototype,"defaultZ",void 0),s([l()],f.prototype,"isDraped",void 0),s([l({value:Ve})],f.prototype,"drawingMode",null),s([l({constructOnly:!0})],f.prototype,"elevationDrawSurface",void 0),s([l({constructOnly:!0})],f.prototype,"elevationInfo",void 0),s([l({constructOnly:!0,type:vt})],f.prototype,"labelOptions",void 0),s([l({constructOnly:!0,type:_t})],f.prototype,"tooltipOptions",void 0),s([l({constructOnly:!0})],f.prototype,"geometryType",void 0),s([l({constructOnly:!0})],f.prototype,"hasM",void 0),s([l({constructOnly:!0})],f.prototype,"hasZ",void 0),s([l()],f.prototype,"cursor",void 0),s([l()],f.prototype,"effectiveCursor",null),s([l()],f.prototype,"loading",void 0),s([l({constructOnly:!0})],f.prototype,"manipulators",void 0),s([l({constructOnly:!0})],f.prototype,"drawSurface",void 0),s([l({constructOnly:!0})],f.prototype,"segmentLabels",void 0),s([l({constructOnly:!0})],f.prototype,"snappingManager",void 0),s([l({constructOnly:!0})],f.prototype,"snappingVisualizer",void 0),s([l()],f.prototype,"snapToSceneEnabled",void 0),s([l()],f.prototype,"stagedVertex",null),s([l()],f.prototype,"lastVertex",void 0),s([l()],f.prototype,"updating",null),s([l({constructOnly:!0})],f.prototype,"view",void 0),f=s([M("esri.views.draw.DrawOperation")],f);class zo{constructor(t,n,i,o=null){this._elevationInfo=t,this.defaultZ=n,this._view=i,this._excludeGraphics=o}screenToMap(t){if(this.defaultZ!=null)return this._view.sceneIntersectionHelper.intersectElevationFromScreen(Jt(t.x,t.y),this._elevationInfo,this.defaultZ,this._excludeGraphics);const n=this._view.sceneIntersectionHelper.intersectElevationFromScreen(Jt(t.x,t.y),this._elevationInfo,0,this._excludeGraphics);return n!=null&&(n.z=void 0),n}mapToScreen(t){const n=Te(t.x,t.y,Zt(this._view,t,this._elevationInfo),t.spatialReference);return this._view.toScreen(n)}constrainZ(t){const{defaultZ:n}=this;return n!=null&&t.z!==n&&((t=bt(t)).z=n),t}}class Go{constructor(t,n,i=[]){this.view=t,this.elevationInfo=n,this.exclude=i}screenToMap(t){const n=this.view.toMap(t,{exclude:this.exclude});return n!=null&&(n.z=dt(n,this.view,this.elevationInfo)),n}mapToScreen(t){let n=t;return this.elevationInfo!=null&&(n=Te(t.x,t.y,Zt(this.view,t,this.elevationInfo),t.spatialReference)),this.view.toScreen(n)}constrainZ(t){return t}}class Do{constructor(t,n=!1,i=0){this.view=t,this.hasZ=n,this.defaultZ=i,this.mapToScreen=o=>t.toScreen(o),this.screenToMap=n?o=>{const a=t.toMap(o);return a.z=i,a}:o=>t.toMap(o)}constrainZ(t){const{defaultZ:n}=this;return this.hasZ&&t.z!==n&&((t=bt(t)).z=n),t}}function ko(e,t){return Ge(e,t,!1)}function Fo(e,t){return Ge(e,t,!0)}function Ge(e,t,n){if(e instanceof Jn){if(e.operation instanceof Kn)return Qi(e.operation,t,n),!0;if(e.operation instanceof ti)return Bi(e.operation,t,n),!0;if(e.operation instanceof ei)return Ji(e.operation,t,n),!0}return!1}function Qi(e,t,n=!1){const i=n?-1:1,o=zn(i*e.dx,i*e.dy,i*e.dz);Gn(t.origin,t.origin,o),wt(t)}function Bi(e,t,n=!1){const i=n?-e.angle:e.angle;Kt(t.basis1,t.basis1,te,i),Kt(t.basis2,t.basis2,te,i),wt(t)}function Ji(e,t,n=!1){const i=n?1/e.factor1:e.factor1,o=n?1/e.factor2:e.factor2;Et(t.basis1,t.basis1,i),Et(t.basis2,t.basis2,o),ee(t.origin,t.origin,e.origin,e.axis1,i),ee(t.origin,t.origin,e.origin,e.axis2,o),wt(t)}function Ho(e,t,n,i){i||(i=Ln());const o=q(tt.get(),e[1],-e[0]),a=q(tt.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),r=q(tt.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),c=tt.get();t.components.forEach(d=>d.vertices.forEach(g=>{const h=g.pos;q(c,ne(e,h),ne(o,h)),Dn(a,a,c),kn(r,r,c)}));const p=1e-6,u=q(tt.get(),r[0]-a[0]<p?n/2:0,r[1]-a[1]<p?n/2:0);return Fn(a,a,u),$t(r,r,u),ie(i.basis1,e,(r[0]-a[0])/2),ie(i.basis2,o,(r[1]-a[1])/2),q(i.origin,a[0]*e[0]+a[1]*o[0],a[0]*e[1]+a[1]*o[1]),$t(i.origin,i.origin,i.basis1),$t(i.origin,i.origin,i.basis2),wt(i),i}export{Ai as C,Vo as D,y as K,Co as O,Io as P,nt as U,ko as V,So as X,Ho as a,Fo as b,Do as c,It as d,Ui as f,Tt as g,Oo as j,f as k,T as l,Go as o,Eo as q,zo as r,Mo as v,Po as w,Ci as x,$o as y,ki as z};
