import{aJ as w,s as H,bj as F,fx as x,aI as R}from"./index-eSY5-lt-.js";import{H as E}from"./colorUtils-d-fcXxMg.js";import{c as V}from"./fontUtils-GE0ho--n.js";import{f as q,y as O,h as W}from"./utils-NbMqmVX1.js";import{t as L,e as I,d as D,l as J}from"./symbolUtils-5r1IAQ7f.js";import"./cimSymbolUtils-i5s4LTBQ.js";import"./utils-jQLeeGOF.js";import"./LRUCache-mFQSPLKh.js";import"./ColorStop-y1faJUUg.js";import"./utils-ogjc0K8k.js";import"./jsonUtils-M3inctU9.js";import"./UniqueValueRenderer-hljh8Sos.js";import"./LegendOptions-x-5oaDqO.js";import"./diffUtils-x5OXhJZZ.js";import"./SizeVariable-221gAT5i.js";import"./colorRamps-rojoPCoV.js";import"./jsonUtils-1IxKPsH1.js";import"./styleUtils-BMYfqyTs.js";import"./DictionaryLoader-W3_-N3pK.js";import"./Version-DuGO31mq.js";import"./FieldsIndex-_W1Us-oq.js";import"./UnknownTimeZone-iVS1S_Kf.js";import"./heatmapUtils-QdzYLNxE.js";import"./webStyleSymbolUtils-kjfVwPY4.js";import"./devEnvironmentUtils-3qgG8Z2w.js";const P="picture-fill",U="picture-marker",G="simple-fill",K="simple-line",N="simple-marker",Q="text",X="Aa",Y=L.size,z=L.maxSize,_=L.maxOutlineSize,$=L.lineWidth,T=225,ee=document.createElement("canvas");function A(a,e){const l=ee.getContext("2d"),i=[];return e&&(e.weight&&i.push(e.weight),e.size&&i.push(e.size+"px"),e.family&&i.push(e.family)),l.font=i.join(" "),l.measureText(a).width}const ae=7.2/2.54,ie=72/2.54;function le(a){if(a.length===0)return 0;if(a.length>2){const e=R(1),l=parseFloat(a);switch(a.slice(-2)){case"px":return l;case"pt":return l*e;case"in":return 72*l*e;case"pc":return 12*l*e;case"mm":return l*ae*e;case"cm":return l*ie*e}}return parseFloat(a)}function k(a){const e=a==null?void 0:a.size;return{width:e!=null&&typeof e=="object"&&"width"in e?w(e.width):null,height:e!=null&&typeof e=="object"&&"height"in e?w(e.height):null}}async function ne(a,e){const l=e.fill,i=a.color;if((l==null?void 0:l.type)==="pattern"&&i&&a.type!==P){const r=await W(l.src,i.toCss(!0));l.src=r,e.fill=l}}async function oe(a,e,l,i){var p,t,c;if(!("font"in a)||!a.font||e.shape.type!=="text")return;try{await V(a.font)}catch{}const{width:r}=k(i),m=/[\uE600-\uE6FF]/.test(e.shape.text);r!=null||m||(l[0]=A(e.shape.text,{weight:(p=e.font)==null?void 0:p.weight,size:(t=e.font)==null?void 0:t.size,family:(c=e.font)==null?void 0:c.family}))}function se(a,e,l,i,r){var m;if(a.haloColor!=null&&a.haloSize!=null){r.masking??(r.masking=l.map(()=>[]));const p=w(a.haloSize);i[0]+=p,i[1]+=p,l.unshift([{...e,fill:null,stroke:{color:a.haloColor,width:2*p,join:"round",cap:"round"}}]),r.masking.unshift([{shape:{type:"rect",x:0,y:0,width:i[0]+2*x,height:i[1]+2*x},fill:[255,255,255],stroke:null},{...e,fill:[0,0,0,0],stroke:null}])}a.backgroundColor==null&&a.borderLineColor==null||(i[0]+=2*x,i[1]+=2*x,l.unshift([{shape:{type:"rect",x:0,y:0,width:i[0],height:i[1]},fill:a.backgroundColor,stroke:{color:a.borderLineColor,width:w(a.borderLineSize)}}]),(m=r.masking)==null||m.unshift([]))}function Z(a,e){return a>e?"dark":"light"}function te(a,e){var M,C;const l=typeof(e==null?void 0:e.size)=="number"?e==null?void 0:e.size:null,i=l!=null?w(l):null,r=(e==null?void 0:e.maxSize)!=null?w(e.maxSize):null,m=(e==null?void 0:e.rotation)!=null?e.rotation:"angle"in a?a.angle:null,p=q(a);let t=O(a);re(a,245)!=="dark"||e!=null&&e.ignoreWhiteSymbols||(t={width:.75,...t,color:"#bdc3c7"});const c={shape:null,fill:p,stroke:t,offset:[0,0]};t!=null&&t.width&&(t.width=Math.min(t.width,_));const d=(t==null?void 0:t.width)||0;let g=(e==null?void 0:e.size)!=null&&((e==null?void 0:e.scale)==null||(e==null?void 0:e.scale)),n=0,o=0,v=!1;switch(a.type){case N:{const u=a.style,{width:h,height:s}=k(e),b=h===s&&h!=null?h:i??Math.min(w(a.size),r||z);switch(n=b,o=b,u){case"circle":c.shape={type:"circle",cx:0,cy:0,r:.5*b},g||(n+=d,o+=d);break;case"cross":c.shape={type:"path",path:[{command:"M",values:[0,.5*o]},{command:"L",values:[n,.5*o]},{command:"M",values:[.5*n,0]},{command:"L",values:[.5*n,o]}]};break;case"diamond":c.shape={type:"path",path:[{command:"M",values:[0,.5*o]},{command:"L",values:[.5*n,0]},{command:"L",values:[n,.5*o]},{command:"L",values:[.5*n,o]},{command:"Z",values:[]}]},g||(n+=d,o+=d);break;case"square":c.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[n,0]},{command:"L",values:[n,o]},{command:"L",values:[0,o]},{command:"Z",values:[]}]},g||(n+=d,o+=d),m&&(v=!0);break;case"triangle":c.shape={type:"path",path:[{command:"M",values:[.5*n,0]},{command:"L",values:[n,o]},{command:"L",values:[0,o]},{command:"Z",values:[]}]},g||(n+=d,o+=d),m&&(v=!0);break;case"x":c.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[n,o]},{command:"M",values:[n,0]},{command:"L",values:[0,o]}]},m&&(v=!0);break;case"path":c.shape={type:"path",path:a.path||""},g||(n+=d,o+=d),m&&(v=!0),g=!0}break}case K:{const{width:u,height:h}=k(e),s=h??i??d,b=u??$;t&&(t.width=s),n=b,o=s;const y=((M=c==null?void 0:c.stroke)==null?void 0:M.cap)||"butt",f=y==="round";g=!0,c.stroke&&(c.stroke.cap=y==="butt"?"square":y),c.shape={type:"path",path:[{command:"M",values:[f?s/2:0,o/2]},{command:"L",values:[f?n-s/2:n,o/2]}]};break}case P:case G:{const u=typeof(e==null?void 0:e.symbolConfig)=="object"&&!!((C=e==null?void 0:e.symbolConfig)!=null&&C.isSquareFill),{width:h,height:s}=k(e);n=!u&&h!==s||h==null?i??Y:h,o=!u&&h!==s||s==null?n:s,g||(n+=d,o+=d),g=!0,c.shape=u?{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[n,0]},{command:"L",values:[n,o]},{command:"L",values:[0,o]},{command:"L",values:[0,0]},{command:"Z",values:[]}]}:I.fill[0];break}case U:{const u=Math.min(w(a.width),r||z),h=Math.min(w(a.height),r||z),{width:s,height:b}=k(e),y=s===b&&s!=null?s:i??Math.max(u,h),f=u/h;n=f<=1?Math.ceil(y*f):y,o=f<=1?y:Math.ceil(y/f),c.shape={type:"image",x:-Math.round(n/2),y:-Math.round(o/2),width:n,height:o,src:a.url||""},m&&(v=!0);break}case Q:{const u=a,h=(e==null?void 0:e.overrideText)||u.text||X,s=u.font,{width:b,height:y}=k(e),f=y??i??Math.min(w(s.size),r||z),B=A(h,{weight:s.weight,size:f,family:s.family}),S=/[\uE600-\uE6FF]/.test(h);n=b??(S?f:B),o=f;let j=.25*le((s?f:0).toString());S&&(j+=5),c.shape={type:"text",text:h,x:u.xoffset||0,y:u.yoffset||j,align:"middle",alignBaseline:u.verticalAlignment,decoration:s&&s.decoration,rotated:u.rotated,kerning:u.kerning},c.font=s&&{size:f,style:s.style,decoration:s.decoration,weight:s.weight,family:s.family};break}}return{shapeDescriptor:c,size:[n,o],renderOptions:{node:e==null?void 0:e.node,scale:g,opacity:e==null?void 0:e.opacity,rotation:m,useRotationSize:v,effectView:e==null?void 0:e.effectView,ariaLabel:e==null?void 0:e.ariaLabel}}}async function qe(a,e){var p;const{shapeDescriptor:l,size:i,renderOptions:r}=te(a,e);if(!l.shape)throw new H("symbolPreview: renderPreviewHTML2D","symbol not supported.");await ne(a,l),await oe(a,l,i,e);const m=[[l]];if(typeof(e==null?void 0:e.symbolConfig)=="object"&&((p=e==null?void 0:e.symbolConfig)!=null&&p.applyColorModulation)){const t=.6*i[0];m.unshift([{...l,offset:[-t,0],fill:D(l.fill,-.3)}]),m.push([{...l,offset:[t,0],fill:D(l.fill,.3)}]),i[0]+=2*t,r.scale=!1}return a.type==="text"&&se(a,l,m,i,r),J(m,i,r)}function re(a,e=T){const l=q(a),i=O(a),r=!l||"type"in l?null:new F(l),m=i!=null&&i.color?new F(i==null?void 0:i.color):null,p=r?Z(E(r),e):null,t=m?Z(E(m),e):null;return t?p?p===t?p:e>=T?"light":"dark":t:p}export{re as getContrastingBackgroundTheme,te as getRenderSymbolParameters,qe as previewSymbol2D};
